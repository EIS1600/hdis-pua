<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>12 Modeling Complex Entities | HDIS: Analysis of Prosopographical Data–with R</title>
  <meta name="description" content="This is a Handbook for Digital Islamicate Studies. Work in progress, based on tought courses." />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="12 Modeling Complex Entities | HDIS: Analysis of Prosopographical Data–with R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a Handbook for Digital Islamicate Studies. Work in progress, based on tought courses." />
  <meta name="github-repo" content="EIS1600/hdis-pua" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="12 Modeling Complex Entities | HDIS: Analysis of Prosopographical Data–with R" />
  
  <meta name="twitter:description" content="This is a Handbook for Digital Islamicate Studies. Work in progress, based on tought courses." />
  

<meta name="author" content="Maxim G. Romanov" />


<meta name="date" content="2023-10-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="touch-icon.png" />
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="prev" href="understanding-geographical-maps.html"/>
<link rel="next" href="chronological-cartograpms.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Handbook of Digital Islamicate Studies</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="about-the-course.html"><a href="about-the-course.html"><i class="fa fa-check"></i>About the Course</a>
<ul>
<li class="chapter" data-level="" data-path="about-the-course.html"><a href="about-the-course.html#syllabus"><i class="fa fa-check"></i>Syllabus</a>
<ul>
<li class="chapter" data-level="" data-path="about-the-course.html"><a href="about-the-course.html#general-description"><i class="fa fa-check"></i>General Description</a></li>
<li class="chapter" data-level="" data-path="about-the-course.html"><a href="about-the-course.html#learning-objectives"><i class="fa fa-check"></i>Learning objectives</a></li>
<li class="chapter" data-level="" data-path="about-the-course.html"><a href="about-the-course.html#didactic-concept"><i class="fa fa-check"></i>Didactic concept</a></li>
<li class="chapter" data-level="0.0.1" data-path="about-the-course.html"><a href="about-the-course.html#course-structure-and-learning-objectives"><i class="fa fa-check"></i><b>0.0.1</b> Course structure and learning objectives:</a></li>
<li class="chapter" data-level="0.0.2" data-path="about-the-course.html"><a href="about-the-course.html#main-object-of-the-course-pua-dataset"><i class="fa fa-check"></i><b>0.0.2</b> Main Object of the Course: PUA Dataset</a></li>
<li class="chapter" data-level="" data-path="about-the-course.html"><a href="about-the-course.html#course-evaluation-requirements-for-the-full-credit"><i class="fa fa-check"></i>Course Evaluation: requirements for the full credit</a></li>
<li class="chapter" data-level="" data-path="about-the-course.html"><a href="about-the-course.html#class-participation"><i class="fa fa-check"></i>Class Participation</a></li>
<li class="chapter" data-level="" data-path="about-the-course.html"><a href="about-the-course.html#homework"><i class="fa fa-check"></i>Homework</a></li>
<li class="chapter" data-level="" data-path="about-the-course.html"><a href="about-the-course.html#final-project"><i class="fa fa-check"></i>Final Project</a></li>
<li class="chapter" data-level="" data-path="about-the-course.html"><a href="about-the-course.html#additional-study-materials"><i class="fa fa-check"></i>Additional Study Materials</a></li>
<li class="chapter" data-level="" data-path="about-the-course.html"><a href="about-the-course.html#software-tools-technologies"><i class="fa fa-check"></i>Software, Tools, &amp; Technologies:</a></li>
<li class="chapter" data-level="" data-path="about-the-course.html"><a href="about-the-course.html#submitting-homework"><i class="fa fa-check"></i>Submitting Homework:</a></li>
<li class="chapter" data-level="" data-path="about-the-course.html"><a href="about-the-course.html#lesson-topics-subject-to-modifications"><i class="fa fa-check"></i>Lesson Topics (<em>subject to modifications</em>)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="setting-everything-up.html"><a href="setting-everything-up.html"><i class="fa fa-check"></i><b>1</b> Setting Everything Up</a>
<ul>
<li class="chapter" data-level="1.1" data-path="setting-everything-up.html"><a href="setting-everything-up.html#links-for-things-to-install"><i class="fa fa-check"></i><b>1.1</b> Links for things to install</a></li>
<li class="chapter" data-level="1.2" data-path="setting-everything-up.html"><a href="setting-everything-up.html#setting-things-up"><i class="fa fa-check"></i><b>1.2</b> Setting Things Up</a></li>
<li class="chapter" data-level="1.3" data-path="setting-everything-up.html"><a href="setting-everything-up.html#creating-a-project"><i class="fa fa-check"></i><b>1.3</b> Creating a Project</a></li>
<li class="chapter" data-level="1.4" data-path="setting-everything-up.html"><a href="setting-everything-up.html#homework-assignments"><i class="fa fa-check"></i><b>1.4</b> Homework assignments</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html"><i class="fa fa-check"></i><b>2</b> RStudio, Basic R Commands, Swirl Tutorials</a>
<ul>
<li class="chapter" data-level="2.1" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html#this-chapter"><i class="fa fa-check"></i><b>2.1</b> This Chapter</a></li>
<li class="chapter" data-level="2.2" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html#overview-of-r"><i class="fa fa-check"></i><b>2.2</b> Overview of R</a></li>
<li class="chapter" data-level="2.3" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html#rstudio-interface"><i class="fa fa-check"></i><b>2.3</b> RStudio Interface</a></li>
<li class="chapter" data-level="2.4" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html#main-file-types"><i class="fa fa-check"></i><b>2.4</b> Main File Types</a></li>
<li class="chapter" data-level="2.5" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html#projects"><i class="fa fa-check"></i><b>2.5</b> Projects</a></li>
<li class="chapter" data-level="2.6" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html#basic-commands"><i class="fa fa-check"></i><b>2.6</b> Basic Commands</a></li>
<li class="chapter" data-level="2.7" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html#built-in-functions"><i class="fa fa-check"></i><b>2.7</b> Built-in Functions</a></li>
<li class="chapter" data-level="2.8" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html#librariespackages"><i class="fa fa-check"></i><b>2.8</b> Libraries/Packages</a></li>
<li class="chapter" data-level="2.9" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html#values-and-their-types"><i class="fa fa-check"></i><b>2.9</b> Values and their types</a></li>
<li class="chapter" data-level="2.10" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html#basic-data-structures-and-their-practical-usage"><i class="fa fa-check"></i><b>2.10</b> Basic Data Structures and Their Practical Usage</a>
<ul>
<li class="chapter" data-level="2.10.1" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html#basic-data-structures"><i class="fa fa-check"></i><b>2.10.1</b> Basic data structures</a></li>
<li class="chapter" data-level="2.10.2" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html#main-properties-of-basic-data-structures"><i class="fa fa-check"></i><b>2.10.2</b> Main properties of basic data structures</a></li>
<li class="chapter" data-level="2.10.3" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html#most-common-usage-of-basic-data-structures"><i class="fa fa-check"></i><b>2.10.3</b> Most Common Usage of Basic Data Structures:</a></li>
<li class="chapter" data-level="2.10.4" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html#basic-data-structures-examples"><i class="fa fa-check"></i><b>2.10.4</b> Basic Data Structures Examples</a></li>
</ul></li>
<li class="chapter" data-level="2.11" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html#homework-with-swirl"><i class="fa fa-check"></i><b>2.11</b> Homework with <code>swirl()</code></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="r-markdown-and-r-notebooks.html"><a href="r-markdown-and-r-notebooks.html"><i class="fa fa-check"></i><b>3</b> R Markdown and R Notebooks</a>
<ul>
<li class="chapter" data-level="3.1" data-path="r-markdown-and-r-notebooks.html"><a href="r-markdown-and-r-notebooks.html#previous-lesson"><i class="fa fa-check"></i><b>3.1</b> Previous lesson</a></li>
<li class="chapter" data-level="3.2" data-path="r-markdown-and-r-notebooks.html"><a href="r-markdown-and-r-notebooks.html#this-lesson"><i class="fa fa-check"></i><b>3.2</b> This lesson</a></li>
<li class="chapter" data-level="3.3" data-path="r-markdown-and-r-notebooks.html"><a href="r-markdown-and-r-notebooks.html#r-notebookmarkdown"><i class="fa fa-check"></i><b>3.3</b> R Notebook/Markdown</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="r-markdown-and-r-notebooks.html"><a href="r-markdown-and-r-notebooks.html#r-notebook-yml-header"><i class="fa fa-check"></i><b>3.3.1</b> R Notebook/ YML Header</a></li>
<li class="chapter" data-level="3.3.2" data-path="r-markdown-and-r-notebooks.html"><a href="r-markdown-and-r-notebooks.html#basics-of-markdown"><i class="fa fa-check"></i><b>3.3.2</b> Basics of Markdown</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="r-markdown-and-r-notebooks.html"><a href="r-markdown-and-r-notebooks.html#homework-1"><i class="fa fa-check"></i><b>3.4</b> Homework</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html"><i class="fa fa-check"></i><b>4</b> Data Manipulation I</a>
<ul>
<li class="chapter" data-level="4.1" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#this-chapter-1"><i class="fa fa-check"></i><b>4.1</b> This Chapter</a></li>
<li class="chapter" data-level="4.2" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#main-data-structures-review"><i class="fa fa-check"></i><b>4.2</b> Main Data Structures — Review</a></li>
<li class="chapter" data-level="4.3" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#why-tidyverse"><i class="fa fa-check"></i><b>4.3</b> Why <code>tidyverse</code>?</a></li>
<li class="chapter" data-level="4.4" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#main-data-file-formats-csv-and-tsv"><i class="fa fa-check"></i><b>4.4</b> Main Data File Formats: CSV and TSV</a></li>
<li class="chapter" data-level="4.5" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#loading-data-into-r"><i class="fa fa-check"></i><b>4.5</b> Loading Data into R</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#loading-csv-and-tsv-files"><i class="fa fa-check"></i><b>4.5.1</b> Loading CSV and TSV files</a></li>
<li class="chapter" data-level="4.5.2" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#r-specific-data-format-rds"><i class="fa fa-check"></i><b>4.5.2</b> R-specific Data “Format”: RDS</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#loading-pua-data"><i class="fa fa-check"></i><b>4.6</b> Loading PUA data</a></li>
<li class="chapter" data-level="4.7" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#pua-dataset-technical-description"><i class="fa fa-check"></i><b>4.7</b> PUA Dataset Technical Description</a></li>
<li class="chapter" data-level="4.8" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#exploring-pua-data"><i class="fa fa-check"></i><b>4.8</b> Exploring PUA Data</a></li>
<li class="chapter" data-level="4.9" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#main-commands-for-engaging-with-a-tibble"><i class="fa fa-check"></i><b>4.9</b> Main commands for engaging with a tibble</a>
<ul>
<li class="chapter" data-level="4.9.1" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#chaining-with"><i class="fa fa-check"></i><b>4.9.1</b> Chaining with <code>%&gt;%</code></a></li>
</ul></li>
<li class="chapter" data-level="4.10" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#important-functions-from-dplyr"><i class="fa fa-check"></i><b>4.10</b> Important Functions from <code>dplyr</code></a></li>
<li class="chapter" data-level="4.11" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#important-functions-from-tidyr"><i class="fa fa-check"></i><b>4.11</b> Important Functions from <code>tidyr</code></a></li>
<li class="chapter" data-level="4.12" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#function-usage"><i class="fa fa-check"></i><b>4.12</b> Function usage</a>
<ul>
<li class="chapter" data-level="4.12.1" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#filter"><i class="fa fa-check"></i><b>4.12.1</b> <code>filter()</code></a></li>
<li class="chapter" data-level="4.12.2" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#select"><i class="fa fa-check"></i><b>4.12.2</b> <code>select()</code></a></li>
<li class="chapter" data-level="4.12.3" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#mutate-and-transmute"><i class="fa fa-check"></i><b>4.12.3</b> <code>mutate()</code> and <code>transmute()</code></a></li>
<li class="chapter" data-level="4.12.4" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#rename"><i class="fa fa-check"></i><b>4.12.4</b> <code>rename()</code></a></li>
<li class="chapter" data-level="4.12.5" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#arrange"><i class="fa fa-check"></i><b>4.12.5</b> <code>arrange()</code></a></li>
<li class="chapter" data-level="4.12.6" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#group_by-ungroup"><i class="fa fa-check"></i><b>4.12.6</b> <code>group_by()</code> / <code>ungroup()</code></a></li>
<li class="chapter" data-level="4.12.7" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#summarise-or-summarize"><i class="fa fa-check"></i><b>4.12.7</b> <code>summarise()</code> or <code>summarize()</code></a></li>
<li class="chapter" data-level="4.12.8" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#join_-functions"><i class="fa fa-check"></i><b>4.12.8</b> <code>join_*</code> functions</a></li>
<li class="chapter" data-level="4.12.9" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#pivot_-functions"><i class="fa fa-check"></i><b>4.12.9</b> <code>pivot_*()</code> functions</a></li>
</ul></li>
<li class="chapter" data-level="4.13" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#homework-tasks"><i class="fa fa-check"></i><b>4.13</b> Homework Tasks</a></li>
<li class="chapter" data-level="4.14" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#appendix-window-function-in-tidyverse"><i class="fa fa-check"></i><b>4.14</b> Appendix: “Window” function in <code>tidyverse</code></a></li>
<li class="chapter" data-level="4.15" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#appendix-pua-database-description"><i class="fa fa-check"></i><b>4.15</b> Appendix: PUA Database Description</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-manipulation-ii.html"><a href="data-manipulation-ii.html"><i class="fa fa-check"></i><b>5</b> Data Manipulation II</a>
<ul>
<li class="chapter" data-level="5.1" data-path="data-manipulation-ii.html"><a href="data-manipulation-ii.html#this-chapter-2"><i class="fa fa-check"></i><b>5.1</b> This Chapter</a></li>
<li class="chapter" data-level="5.2" data-path="data-manipulation-ii.html"><a href="data-manipulation-ii.html#problems"><i class="fa fa-check"></i><b>5.2</b> Problems</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="data-manipulation-ii.html"><a href="data-manipulation-ii.html#who-is-the-oldest-individual-we-have-in-the-pua-data"><i class="fa fa-check"></i><b>5.2.1</b> [1] Who is the oldest individual we have in the PUA data?</a></li>
<li class="chapter" data-level="5.2.2" data-path="data-manipulation-ii.html"><a href="data-manipulation-ii.html#which-places-did-this-individual-visit"><i class="fa fa-check"></i><b>5.2.2</b> [2] Which places did this individual visit?</a></li>
<li class="chapter" data-level="5.2.3" data-path="data-manipulation-ii.html"><a href="data-manipulation-ii.html#what-kind-of-activities-was-that-individual-involved-in"><i class="fa fa-check"></i><b>5.2.3</b> [3] What kind of activities was that individual involved in?</a></li>
<li class="chapter" data-level="5.2.4" data-path="data-manipulation-ii.html"><a href="data-manipulation-ii.html#who-is-the-oldest-jurist-faqīh-in-the-pua-data"><i class="fa fa-check"></i><b>5.2.4</b> [4] Who is the oldest jurist (<em>faqīh</em>) in the PUA data?</a></li>
<li class="chapter" data-level="5.2.5" data-path="data-manipulation-ii.html"><a href="data-manipulation-ii.html#can-you-find-a-century-in-which-andalusians-traveled-the-most"><i class="fa fa-check"></i><b>5.2.5</b> [6] Can you find a century in which Andalusians traveled the most?</a></li>
<li class="chapter" data-level="5.2.6" data-path="data-manipulation-ii.html"><a href="data-manipulation-ii.html#what-are-the-10-most-common-activities-andalusians-were-involved-into"><i class="fa fa-check"></i><b>5.2.6</b> [7] What are the 10 most common activities Andalusians were involved into?</a></li>
<li class="chapter" data-level="5.2.7" data-path="data-manipulation-ii.html"><a href="data-manipulation-ii.html#what-are-the-most-common-activities-in-the-5th-ah-century"><i class="fa fa-check"></i><b>5.2.7</b> [8] What are the most common activities in the 5th AH century?</a></li>
<li class="chapter" data-level="5.2.8" data-path="data-manipulation-ii.html"><a href="data-manipulation-ii.html#what-are-the-main-locations-of-the-5-largest-families-places-from-familia"><i class="fa fa-check"></i><b>5.2.8</b> [9] What are the main locations of the 5 largest families? (places from <code>familia</code>)</a></li>
<li class="chapter" data-level="5.2.9" data-path="data-manipulation-ii.html"><a href="data-manipulation-ii.html#what-are-the-most-visited-locations-among-the-members-of-those-families-places-from-personaje_lugar"><i class="fa fa-check"></i><b>5.2.9</b> [10] What are the most visited locations among the members of those families? (places from <code>personaje_lugar</code>)</a></li>
<li class="chapter" data-level="5.2.10" data-path="data-manipulation-ii.html"><a href="data-manipulation-ii.html#in-which-century-do-we-have-the-largest-number-of-families"><i class="fa fa-check"></i><b>5.2.10</b> [11] In which century do we have the largest number of families?</a></li>
<li class="chapter" data-level="5.2.11" data-path="data-manipulation-ii.html"><a href="data-manipulation-ii.html#what-is-the-peak-century-in-the-history-of-al-andalus-this-can-be-measured-by-the-highest-number-of-people."><i class="fa fa-check"></i><b>5.2.11</b> [12] What is the peak century in the history of al-Andalus? (This can be measured by the highest number of people.)</a></li>
<li class="chapter" data-level="5.2.12" data-path="data-manipulation-ii.html"><a href="data-manipulation-ii.html#what-is-the-most-prominent-location-in-al-andalus-in-general-what-about-by-centuries-prominent-means-that-it-has-the-highest-number-of-people-associated-with-it."><i class="fa fa-check"></i><b>5.2.12</b> [13] What is the most prominent location in al-Andalus in general? What about by centuries? (Prominent means that it has the highest number of people associated with it.)</a></li>
<li class="chapter" data-level="5.2.13" data-path="data-manipulation-ii.html"><a href="data-manipulation-ii.html#what-is-the-most-prominent-location-outside-of-al-andalus-what-about-by-centuries"><i class="fa fa-check"></i><b>5.2.13</b> [14] What is the most prominent location outside of al-Andalus? What about by centuries?</a></li>
<li class="chapter" data-level="5.2.14" data-path="data-manipulation-ii.html"><a href="data-manipulation-ii.html#do-the-same-task-but-for-common-era-centuries."><i class="fa fa-check"></i><b>5.2.14</b> [15] Do the same task, but for common era centuries.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="control-flow-regular-expressions.html"><a href="control-flow-regular-expressions.html"><i class="fa fa-check"></i><b>6</b> Control Flow; Regular Expressions</a>
<ul>
<li class="chapter" data-level="6.1" data-path="control-flow-regular-expressions.html"><a href="control-flow-regular-expressions.html#this-chapter-3"><i class="fa fa-check"></i><b>6.1</b> This Chapter</a></li>
<li class="chapter" data-level="6.2" data-path="control-flow-regular-expressions.html"><a href="control-flow-regular-expressions.html#control-flow"><i class="fa fa-check"></i><b>6.2</b> Control Flow</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="control-flow-regular-expressions.html"><a href="control-flow-regular-expressions.html#conditional-statements"><i class="fa fa-check"></i><b>6.2.1</b> Conditional statements</a></li>
<li class="chapter" data-level="6.2.2" data-path="control-flow-regular-expressions.html"><a href="control-flow-regular-expressions.html#loops"><i class="fa fa-check"></i><b>6.2.2</b> Loops</a></li>
<li class="chapter" data-level="6.2.3" data-path="control-flow-regular-expressions.html"><a href="control-flow-regular-expressions.html#functions"><i class="fa fa-check"></i><b>6.2.3</b> Functions</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="control-flow-regular-expressions.html"><a href="control-flow-regular-expressions.html#regular-expressions-in-r"><i class="fa fa-check"></i><b>6.3</b> Regular Expressions in R</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="control-flow-regular-expressions.html"><a href="control-flow-regular-expressions.html#basics-of-regular-expressions"><i class="fa fa-check"></i><b>6.3.1</b> Basics of Regular Expressions</a></li>
<li class="chapter" data-level="6.3.2" data-path="control-flow-regular-expressions.html"><a href="control-flow-regular-expressions.html#regular-expressions-in-r-1"><i class="fa fa-check"></i><b>6.3.2</b> Regular Expressions in R</a></li>
<li class="chapter" data-level="6.3.3" data-path="control-flow-regular-expressions.html"><a href="control-flow-regular-expressions.html#tips-for-regular-expressions-in-r"><i class="fa fa-check"></i><b>6.3.3</b> Tips for Regular Expressions in R</a></li>
<li class="chapter" data-level="6.3.4" data-path="control-flow-regular-expressions.html"><a href="control-flow-regular-expressions.html#in-class-practice"><i class="fa fa-check"></i><b>6.3.4</b> In-Class Practice</a></li>
<li class="chapter" data-level="6.3.5" data-path="control-flow-regular-expressions.html"><a href="control-flow-regular-expressions.html#the-practice-regex-file"><i class="fa fa-check"></i><b>6.3.5</b> The Practice Regex File</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html"><i class="fa fa-check"></i><b>7</b> Getting Your Data Right</a>
<ul>
<li class="chapter" data-level="7.1" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html#this-chapter-4"><i class="fa fa-check"></i><b>7.1</b> This Chapter</a></li>
<li class="chapter" data-level="7.2" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html#getting-your-own-data"><i class="fa fa-check"></i><b>7.2</b> 1. Getting your own data</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html#ways-of-obtaining-data"><i class="fa fa-check"></i><b>7.2.1</b> Ways of obtaining data</a></li>
<li class="chapter" data-level="7.2.2" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html#major-formats"><i class="fa fa-check"></i><b>7.2.2</b> Major formats</a></li>
<li class="chapter" data-level="7.2.3" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html#ways-of-obtaining-data-1"><i class="fa fa-check"></i><b>7.2.3</b> Ways of obtaining data</a></li>
<li class="chapter" data-level="7.2.4" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html#major-formats-1"><i class="fa fa-check"></i><b>7.2.4</b> Major formats</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html#tidying-data"><i class="fa fa-check"></i><b>7.3</b> 2. Tidying Data</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html#basic-principles-of-organizing-data-tidy-data"><i class="fa fa-check"></i><b>7.3.1</b> Basic principles of organizing data: <em>Tidy Data</em></a></li>
<li class="chapter" data-level="7.3.2" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html#clean-data-tidy-data-additional-explanations"><i class="fa fa-check"></i><b>7.3.2</b> Clean Data / Tidy Data: <em>additional explanations</em></a></li>
<li class="chapter" data-level="7.3.3" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html#discussion-a-bulliet-dataset"><i class="fa fa-check"></i><b>7.3.3</b> <em>Discussion</em>: “A Bulliet Dataset”</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html#modeling-data"><i class="fa fa-check"></i><b>7.4</b> 3. Modeling Data</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html#categorization-as-a-way-of-modeling-data"><i class="fa fa-check"></i><b>7.4.1</b> Categorization as a Way of modeling data</a></li>
<li class="chapter" data-level="7.4.2" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html#normalization"><i class="fa fa-check"></i><b>7.4.2</b> Normalization</a></li>
<li class="chapter" data-level="7.4.3" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html#note-proxies-features-abstractions"><i class="fa fa-check"></i><b>7.4.3</b> Note: <em>Proxies</em>, <em>Features</em>, <em>Abstractions</em></a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html#appendix-ocr-with-r"><i class="fa fa-check"></i><b>7.5</b> Appendix: OCR with R</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="deep-look-into-the-pua-dataset.html"><a href="deep-look-into-the-pua-dataset.html"><i class="fa fa-check"></i><b>8</b> Deep Look into the PUA Dataset</a>
<ul>
<li class="chapter" data-level="8.1" data-path="deep-look-into-the-pua-dataset.html"><a href="deep-look-into-the-pua-dataset.html#updated-pua-dataset"><i class="fa fa-check"></i><b>8.1</b> Updated PUA Dataset</a></li>
<li class="chapter" data-level="8.2" data-path="deep-look-into-the-pua-dataset.html"><a href="deep-look-into-the-pua-dataset.html#normalized-and-improved-pua-dataset"><i class="fa fa-check"></i><b>8.2</b> Normalized and Improved PUA Dataset</a></li>
<li class="chapter" data-level="8.3" data-path="deep-look-into-the-pua-dataset.html"><a href="deep-look-into-the-pua-dataset.html#modeling-pua-dataset"><i class="fa fa-check"></i><b>8.3</b> Modeling PUA Dataset</a></li>
<li class="chapter" data-level="8.4" data-path="deep-look-into-the-pua-dataset.html"><a href="deep-look-into-the-pua-dataset.html#conceptual-models-for-your-data"><i class="fa fa-check"></i><b>8.4</b> Conceptual Models for Your Data</a></li>
<li class="chapter" data-level="8.5" data-path="deep-look-into-the-pua-dataset.html"><a href="deep-look-into-the-pua-dataset.html#implementation"><i class="fa fa-check"></i><b>8.5</b> Implementation</a></li>
<li class="chapter" data-level="8.6" data-path="deep-look-into-the-pua-dataset.html"><a href="deep-look-into-the-pua-dataset.html#homework-assignment"><i class="fa fa-check"></i><b>8.6</b> Homework assignment</a></li>
<li class="chapter" data-level="8.7" data-path="deep-look-into-the-pua-dataset.html"><a href="deep-look-into-the-pua-dataset.html#reference-materials"><i class="fa fa-check"></i><b>8.7</b> Reference Materials</a></li>
<li class="chapter" data-level="8.8" data-path="deep-look-into-the-pua-dataset.html"><a href="deep-look-into-the-pua-dataset.html#appendix-1-pua-data-tables"><i class="fa fa-check"></i><b>8.8</b> Appendix 1: PUA Data Tables</a>
<ul>
<li class="chapter" data-level="8.8.1" data-path="deep-look-into-the-pua-dataset.html"><a href="deep-look-into-the-pua-dataset.html#main-table"><i class="fa fa-check"></i><b>8.8.1</b> Main Table</a></li>
<li class="chapter" data-level="8.8.2" data-path="deep-look-into-the-pua-dataset.html"><a href="deep-look-into-the-pua-dataset.html#connection-tables"><i class="fa fa-check"></i><b>8.8.2</b> Connection Tables</a></li>
<li class="chapter" data-level="8.8.3" data-path="deep-look-into-the-pua-dataset.html"><a href="deep-look-into-the-pua-dataset.html#auxiliary-tables"><i class="fa fa-check"></i><b>8.8.3</b> Auxiliary Tables</a></li>
<li class="chapter" data-level="8.8.4" data-path="deep-look-into-the-pua-dataset.html"><a href="deep-look-into-the-pua-dataset.html#metadata-tables"><i class="fa fa-check"></i><b>8.8.4</b> Metadata Tables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html"><i class="fa fa-check"></i><b>9</b> Visualizations: <code>plot()</code> and <code>ggplot()</code></a>
<ul>
<li class="chapter" data-level="9.1" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#this-chapter-5"><i class="fa fa-check"></i><b>9.1</b> This Chapter</a></li>
<li class="chapter" data-level="9.2" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#conceptual-issues"><i class="fa fa-check"></i><b>9.2</b> Conceptual Issues</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#perception"><i class="fa fa-check"></i><b>9.2.1</b> Perception</a></li>
<li class="chapter" data-level="9.2.2" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#the-rules-of-thumb-for-visualizations"><i class="fa fa-check"></i><b>9.2.2</b> The Rules of Thumb for Visualizations</a></li>
<li class="chapter" data-level="9.2.3" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#types-of-graphs-and-when-to-use-them"><i class="fa fa-check"></i><b>9.2.3</b> Types of Graphs and When to Use Them</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#r-built-in-graphics-functions-quick-overview"><i class="fa fa-check"></i><b>9.3</b> R Built-in Graphics Functions: Quick Overview</a></li>
<li class="chapter" data-level="9.4" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#tidyverse-graphs-ggplot2"><i class="fa fa-check"></i><b>9.4</b> <code>Tidyverse</code> Graphs: <code>ggplot2</code></a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#grammar-of-graphics"><i class="fa fa-check"></i><b>9.4.1</b> Grammar of Graphics</a></li>
<li class="chapter" data-level="9.4.2" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#code-breakdown"><i class="fa fa-check"></i><b>9.4.2</b> Code Breakdown</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#simpler-graphs"><i class="fa fa-check"></i><b>9.5</b> Simpler graphs</a></li>
<li class="chapter" data-level="9.6" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#other-types-of-graphs"><i class="fa fa-check"></i><b>9.6</b> Other types of graphs</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#scatter-plots"><i class="fa fa-check"></i><b>9.6.1</b> 1. Scatter plots</a></li>
<li class="chapter" data-level="9.6.2" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#line-charts"><i class="fa fa-check"></i><b>9.6.2</b> 2. Line charts</a></li>
<li class="chapter" data-level="9.6.3" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#bar-charts"><i class="fa fa-check"></i><b>9.6.3</b> 3. Bar charts</a></li>
<li class="chapter" data-level="9.6.4" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#histograms"><i class="fa fa-check"></i><b>9.6.4</b> 4. Histograms</a></li>
<li class="chapter" data-level="9.6.5" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#wordclouds"><i class="fa fa-check"></i><b>9.6.5</b> 5. Wordclouds</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#homework-assignment-1"><i class="fa fa-check"></i><b>9.7</b> Homework assignment</a></li>
<li class="chapter" data-level="9.8" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#final-word"><i class="fa fa-check"></i><b>9.8</b> Final word</a></li>
<li class="chapter" data-level="9.9" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#graphing-data"><i class="fa fa-check"></i><b>9.9</b> Graphing Data</a></li>
<li class="chapter" data-level="9.10" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#appendices"><i class="fa fa-check"></i><b>9.10</b> Appendices</a>
<ul>
<li class="chapter" data-level="9.10.1" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#appendix-1-when-a-simple-table-may-suffice"><i class="fa fa-check"></i><b>9.10.1</b> Appendix 1: When a “Simple” Table May Suffice</a></li>
</ul></li>
<li class="chapter" data-level="9.11" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#appendix-interactive-graphs"><i class="fa fa-check"></i><b>9.11</b> Appendix: Interactive Graphs</a>
<ul>
<li class="chapter" data-level="9.11.1" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#appendix-checklist-for-creating-visualizations"><i class="fa fa-check"></i><b>9.11.1</b> Appendix: Checklist for Creating Visualizations</a></li>
</ul></li>
<li class="chapter" data-level="9.12" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#appendix-scientific-notation"><i class="fa fa-check"></i><b>9.12</b> Appendix: Scientific Notation</a></li>
<li class="chapter" data-level="9.13" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#homework-solutions-partial"><i class="fa fa-check"></i><b>9.13</b> Homework solutions (partial)</a>
<ul>
<li class="chapter" data-level="9.13.1" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#line-charts-1"><i class="fa fa-check"></i><b>9.13.1</b> Line charts</a></li>
<li class="chapter" data-level="9.13.2" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#bar-charts-1"><i class="fa fa-check"></i><b>9.13.2</b> 3. Bar charts</a></li>
<li class="chapter" data-level="9.13.3" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#histograms-1"><i class="fa fa-check"></i><b>9.13.3</b> 4. Histograms</a></li>
<li class="chapter" data-level="9.13.4" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#wordclouds---homework"><i class="fa fa-check"></i><b>9.13.4</b> 5. Wordclouds - Homework</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="overview-of-the-pua-dataset.html"><a href="overview-of-the-pua-dataset.html"><i class="fa fa-check"></i><b>10</b> Overview of the PUA dataset</a>
<ul>
<li class="chapter" data-level="10.1" data-path="overview-of-the-pua-dataset.html"><a href="overview-of-the-pua-dataset.html#the-initial-sql-database-extraction-of-tables"><i class="fa fa-check"></i><b>10.1</b> The initial SQL Database: extraction of tables</a></li>
<li class="chapter" data-level="10.2" data-path="overview-of-the-pua-dataset.html"><a href="overview-of-the-pua-dataset.html#extracting-tables-with-r"><i class="fa fa-check"></i><b>10.2</b> Extracting tables with R</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="overview-of-the-pua-dataset.html"><a href="overview-of-the-pua-dataset.html#looking-at-the-data"><i class="fa fa-check"></i><b>10.2.1</b> Looking at the data</a></li>
<li class="chapter" data-level="10.2.2" data-path="overview-of-the-pua-dataset.html"><a href="overview-of-the-pua-dataset.html#reorganization-conceptual-model-for-your-data"><i class="fa fa-check"></i><b>10.2.2</b> Reorganization: Conceptual Model For Your Data</a></li>
<li class="chapter" data-level="10.2.3" data-path="overview-of-the-pua-dataset.html"><a href="overview-of-the-pua-dataset.html#improving-pua-data"><i class="fa fa-check"></i><b>10.2.3</b> Improving PUA Data</a></li>
<li class="chapter" data-level="10.2.4" data-path="overview-of-the-pua-dataset.html"><a href="overview-of-the-pua-dataset.html#from-the-previous-lesson"><i class="fa fa-check"></i><b>10.2.4</b> From the previous lesson</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="understanding-geographical-maps.html"><a href="understanding-geographical-maps.html"><i class="fa fa-check"></i><b>11</b> Understanding Geographical Maps</a>
<ul>
<li class="chapter" data-level="11.1" data-path="understanding-geographical-maps.html"><a href="understanding-geographical-maps.html#creating-base-maps"><i class="fa fa-check"></i><b>11.1</b> Creating Base Maps</a></li>
<li class="chapter" data-level="11.2" data-path="understanding-geographical-maps.html"><a href="understanding-geographical-maps.html#core-concepts-and-their-practical-implementations"><i class="fa fa-check"></i><b>11.2</b> Core concepts and their practical implementations</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="understanding-geographical-maps.html"><a href="understanding-geographical-maps.html#projection-issues"><i class="fa fa-check"></i><b>11.2.1</b> Projection Issues</a></li>
<li class="chapter" data-level="11.2.2" data-path="understanding-geographical-maps.html"><a href="understanding-geographical-maps.html#a-digital-map-layers-of-goodness"><i class="fa fa-check"></i><b>11.2.2</b> A Digital Map: Layers of Goodness</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="understanding-geographical-maps.html"><a href="understanding-geographical-maps.html#main-types-of-data-points-lines-polygons"><i class="fa fa-check"></i><b>11.3</b> Main Types of Data: Points, Lines, Polygons</a></li>
<li class="chapter" data-level="11.4" data-path="understanding-geographical-maps.html"><a href="understanding-geographical-maps.html#base-maps"><i class="fa fa-check"></i><b>11.4</b> Base maps</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="understanding-geographical-maps.html"><a href="understanding-geographical-maps.html#new-libraries"><i class="fa fa-check"></i><b>11.4.1</b> New libraries</a></li>
<li class="chapter" data-level="11.4.2" data-path="understanding-geographical-maps.html"><a href="understanding-geographical-maps.html#compiling-the-base-map"><i class="fa fa-check"></i><b>11.4.2</b> Compiling the base map</a></li>
<li class="chapter" data-level="11.4.3" data-path="understanding-geographical-maps.html"><a href="understanding-geographical-maps.html#adding-data"><i class="fa fa-check"></i><b>11.4.3</b> Adding data</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="understanding-geographical-maps.html"><a href="understanding-geographical-maps.html#reusable-base-map-for-al-andalus"><i class="fa fa-check"></i><b>11.5</b> Reusable Base Map for al-Andalus</a></li>
<li class="chapter" data-level="11.6" data-path="understanding-geographical-maps.html"><a href="understanding-geographical-maps.html#raster-base-maps"><i class="fa fa-check"></i><b>11.6</b> Raster base maps</a></li>
<li class="chapter" data-level="11.7" data-path="understanding-geographical-maps.html"><a href="understanding-geographical-maps.html#homework-2"><i class="fa fa-check"></i><b>11.7</b> Homework</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="modeling-complex-entities.html"><a href="modeling-complex-entities.html"><i class="fa fa-check"></i><b>12</b> Modeling Complex Entities</a>
<ul>
<li class="chapter" data-level="12.1" data-path="modeling-complex-entities.html"><a href="modeling-complex-entities.html#modeling-regions"><i class="fa fa-check"></i><b>12.1</b> Modeling Regions</a></li>
<li class="chapter" data-level="12.2" data-path="modeling-complex-entities.html"><a href="modeling-complex-entities.html#modeling-periods"><i class="fa fa-check"></i><b>12.2</b> Modeling Periods</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="modeling-complex-entities.html"><a href="modeling-complex-entities.html#a-1000-and-1-tries"><i class="fa fa-check"></i><b>12.2.1</b> A 1000 And 1 Tries</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="modeling-complex-entities.html"><a href="modeling-complex-entities.html#intermediate-summary"><i class="fa fa-check"></i><b>12.3</b> Intermediate Summary</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="chronological-cartograpms.html"><a href="chronological-cartograpms.html"><i class="fa fa-check"></i><b>13</b> Chronological Cartograpms</a>
<ul>
<li class="chapter" data-level="13.0.1" data-path="chronological-cartograpms.html"><a href="chronological-cartograpms.html#animated-map-approach"><i class="fa fa-check"></i><b>13.0.1</b> Animated Map Approach</a></li>
<li class="chapter" data-level="13.0.2" data-path="chronological-cartograpms.html"><a href="chronological-cartograpms.html#frame-by-frame-approach"><i class="fa fa-check"></i><b>13.0.2</b> “Frame-by-Frame” Approach</a></li>
<li class="chapter" data-level="13.1" data-path="chronological-cartograpms.html"><a href="chronological-cartograpms.html#chrono-geographical-information-without-maps"><i class="fa fa-check"></i><b>13.1</b> Chrono-Geographical Information without Maps</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="geographical-networks.html"><a href="geographical-networks.html"><i class="fa fa-check"></i><b>14</b> Geographical Networks</a></li>
<li class="chapter" data-level="15" data-path="social-networks.html"><a href="social-networks.html"><i class="fa fa-check"></i><b>15</b> Social Networks</a></li>
<li class="chapter" data-level="16" data-path="glossary-of-computer-terms.html"><a href="glossary-of-computer-terms.html"><i class="fa fa-check"></i><b>16</b> Glossary of Computer Terms</a>
<ul>
<li class="chapter" data-level="16.1" data-path="glossary-of-computer-terms.html"><a href="glossary-of-computer-terms.html#general-computer-terms"><i class="fa fa-check"></i><b>16.1</b> General Computer Terms</a></li>
<li class="chapter" data-level="16.2" data-path="glossary-of-computer-terms.html"><a href="glossary-of-computer-terms.html#r-specific-terms"><i class="fa fa-check"></i><b>16.2</b> R-Specific Terms</a></li>
<li class="chapter" data-level="16.3" data-path="glossary-of-computer-terms.html"><a href="glossary-of-computer-terms.html#nlp-and-linguistics"><i class="fa fa-check"></i><b>16.3</b> NLP and Linguistics</a></li>
<li class="chapter" data-level="16.4" data-path="glossary-of-computer-terms.html"><a href="glossary-of-computer-terms.html#machine-learning"><i class="fa fa-check"></i><b>16.4</b> Machine Learning</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="appendices-1.html"><a href="appendices-1.html"><i class="fa fa-check"></i><b>17</b> Appendices</a>
<ul>
<li class="chapter" data-level="17.1" data-path="appendices-1.html"><a href="appendices-1.html#appendix-i-importance-of-basic-computer-skills-for-humanists"><i class="fa fa-check"></i><b>17.1</b> Appendix I: Importance of basic computer skills for humanists</a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="appendices-1.html"><a href="appendices-1.html#importance-of-basic-computer-skills-for-humanists"><i class="fa fa-check"></i><b>17.1.1</b> Importance of basic computer skills for humanists</a></li>
<li class="chapter" data-level="17.1.2" data-path="appendices-1.html"><a href="appendices-1.html#access-to-information"><i class="fa fa-check"></i><b>17.1.2</b> Access to information</a></li>
<li class="chapter" data-level="17.1.3" data-path="appendices-1.html"><a href="appendices-1.html#organization-and-management-of-research-material"><i class="fa fa-check"></i><b>17.1.3</b> Organization and management of research material</a></li>
<li class="chapter" data-level="17.1.4" data-path="appendices-1.html"><a href="appendices-1.html#file-organization"><i class="fa fa-check"></i><b>17.1.4</b> File Organization</a></li>
<li class="chapter" data-level="17.1.5" data-path="appendices-1.html"><a href="appendices-1.html#finding-your-way-around-the-computer"><i class="fa fa-check"></i><b>17.1.5</b> Finding your way around the computer</a></li>
<li class="chapter" data-level="17.1.6" data-path="appendices-1.html"><a href="appendices-1.html#common-file-formats-and-extensions"><i class="fa fa-check"></i><b>17.1.6</b> Common file formats and extensions</a></li>
<li class="chapter" data-level="17.1.7" data-path="appendices-1.html"><a href="appendices-1.html#organizing-files-and-folders-for-research-projects"><i class="fa fa-check"></i><b>17.1.7</b> Organizing files and folders for research projects</a></li>
<li class="chapter" data-level="17.1.8" data-path="appendices-1.html"><a href="appendices-1.html#demonstration-of-file-navigation-using-a-file-explorer-windows-or-finder-mac"><i class="fa fa-check"></i><b>17.1.8</b> Demonstration of file navigation using a file explorer (Windows) or Finder (Mac)</a></li>
<li class="chapter" data-level="17.1.9" data-path="appendices-1.html"><a href="appendices-1.html#command-line-basics"><i class="fa fa-check"></i><b>17.1.9</b> Command Line Basics</a></li>
<li class="chapter" data-level="17.1.10" data-path="appendices-1.html"><a href="appendices-1.html#introduction-to-command-line-interfaces"><i class="fa fa-check"></i><b>17.1.10</b> Introduction to command line interfaces</a></li>
<li class="chapter" data-level="17.1.11" data-path="appendices-1.html"><a href="appendices-1.html#command-line-basic-commands"><i class="fa fa-check"></i><b>17.1.11</b> Command Line: Basic Commands</a></li>
<li class="chapter" data-level="17.1.12" data-path="appendices-1.html"><a href="appendices-1.html#creating-moving-renaming-and-deleting-files-and-folders"><i class="fa fa-check"></i><b>17.1.12</b> Creating, moving, renaming, and deleting files and folders</a></li>
<li class="chapter" data-level="17.1.13" data-path="appendices-1.html"><a href="appendices-1.html#tips-for-efficient-command-line-usage"><i class="fa fa-check"></i><b>17.1.13</b> Tips for efficient command line usage</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="bibliography.html"><a href="bibliography.html"><i class="fa fa-check"></i><b>18</b> Bibliography</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">HDIS: Analysis of Prosopographical Data–with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="modeling-complex-entities" class="section level1 hasAnchor" number="12">
<h1><span class="header-section-number">12</span> Modeling Complex Entities<a href="modeling-complex-entities.html#modeling-complex-entities" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="modeling-regions" class="section level2 hasAnchor" number="12.1">
<h2><span class="header-section-number">12.1</span> Modeling Regions<a href="modeling-complex-entities.html#modeling-regions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s begin with loading necessary libraries and the PUA data.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="modeling-complex-entities.html#cb1-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="modeling-complex-entities.html#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="modeling-complex-entities.html#cb1-3" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-4"><a href="modeling-complex-entities.html#cb1-4" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb1-5"><a href="modeling-complex-entities.html#cb1-5" tabindex="-1"></a><span class="fu">library</span>(rnaturalearthdata)</span>
<span id="cb1-6"><a href="modeling-complex-entities.html#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="modeling-complex-entities.html#cb1-7" tabindex="-1"></a><span class="fu">library</span>(ggmap)</span>
<span id="cb1-8"><a href="modeling-complex-entities.html#cb1-8" tabindex="-1"></a><span class="fu">library</span>(ggspatial)</span>
<span id="cb1-9"><a href="modeling-complex-entities.html#cb1-9" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb1-10"><a href="modeling-complex-entities.html#cb1-10" tabindex="-1"></a></span>
<span id="cb1-11"><a href="modeling-complex-entities.html#cb1-11" tabindex="-1"></a>PUA <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;./data/PUA_processed/PUA_allDataTables_asList.rds&quot;</span>)</span></code></pre></div>
<p>We now can load the prepared basemap and then customize its appearance with a theme, or load a basemaps with a theme already applied. This way we can now focus only on the data that needs to be added to the basemap.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="modeling-complex-entities.html#cb2-1" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;./data/basemap/base_plot_andalus_themed.RData&quot;</span>)</span>
<span id="cb2-2"><a href="modeling-complex-entities.html#cb2-2" tabindex="-1"></a>base_plot_andalus_themed</span></code></pre></div>
<p><img src="handbook_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>We have discussed an option of grouping toponyms into regions by some kind of historical administrative divisions. However, we also ran into a problem of instability of such aggregations, which complicates this task.</p>
<p>Another option—or, perhaps, a complimentary option—is to aggregate smaller toponyms into larger places algorithmically. Namely, we can select a certain number of settlements that would act as magnets (let’s call them gravitons), absorbing smaller places (let’s call them satellites). We can make a selection of gravitons based on their importance: for example, based on how many people we find associated with those places in the PUA data. Then, we can then use some algorithmic solution to associate all minor places with the closest graviton. For example, we can calculate distances* from each sattelite to all the gravitons; then we can associate each satellite with the closest graviton. This appraach will not necessarily create the best representation of sub-regions, but it is fast and quite transparent. After creating this algorithmic divisions we can always tweak associations of individual satellites according to our additional knowledge which we did not factor in into the algorithmic implementation. The advantage of such an approach is also in its flexibility: not only can we can always readjust these divisions, we can also experiment with different variations until we find the most optimal one.</p>
<p>Let’s find our top places first. We can pick them from a map that we generated before. Looking at a map is always a good idea, since we may want to combine two prominent locations that are very close to each other into a single graviton; and we might want to single out a minor location as a graviton in order to preserve a representation of some remote region that does not have locations with high frequencies.</p>
<p><img src="images/generated/PUAR_Cl09_Map01.png" /></p>
<p>Based on the map, I would start with a the following vector (roughly, west to east):</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="modeling-complex-entities.html#cb3-1" tabindex="-1"></a>imanes_vector <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Silves&quot;</span>, <span class="st">&quot;Badajoz&quot;</span>, <span class="st">&quot;Sevilla&quot;</span>, <span class="st">&quot;Algeciras&quot;</span>, <span class="st">&quot;Córdoba&quot;</span>,</span>
<span id="cb3-2"><a href="modeling-complex-entities.html#cb3-2" tabindex="-1"></a>                   <span class="st">&quot;Málaga&quot;</span>, <span class="st">&quot;Toledo&quot;</span>, <span class="st">&quot;Granada&quot;</span>, <span class="st">&quot;Almeria&quot;</span>, <span class="st">&quot;Murcia&quot;</span>,</span>
<span id="cb3-3"><a href="modeling-complex-entities.html#cb3-3" tabindex="-1"></a>                   <span class="st">&quot;Valencia&quot;</span>, <span class="st">&quot;Zaragoza&quot;</span>, <span class="st">&quot;Mallorca (isla)&quot;</span>)</span>
<span id="cb3-4"><a href="modeling-complex-entities.html#cb3-4" tabindex="-1"></a></span>
<span id="cb3-5"><a href="modeling-complex-entities.html#cb3-5" tabindex="-1"></a>imanes <span class="ot">&lt;-</span> PUA<span class="sc">$</span>lugar <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="modeling-complex-entities.html#cb3-6" tabindex="-1"></a>  <span class="fu">filter</span>(nombre_castellano <span class="sc">%in%</span> imanes_vector) <span class="sc">%&gt;%</span></span>
<span id="cb3-7"><a href="modeling-complex-entities.html#cb3-7" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">region =</span> nombre_castellano, <span class="at">latR =</span> lat, <span class="at">lngR =</span> lng) <span class="sc">%&gt;%</span></span>
<span id="cb3-8"><a href="modeling-complex-entities.html#cb3-8" tabindex="-1"></a>  <span class="fu">select</span>(region, latR, lngR)</span>
<span id="cb3-9"><a href="modeling-complex-entities.html#cb3-9" tabindex="-1"></a></span>
<span id="cb3-10"><a href="modeling-complex-entities.html#cb3-10" tabindex="-1"></a>imanes</span></code></pre></div>
<pre><code>## # A tibble: 12 × 3
##    region           latR   lngR
##    &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;
##  1 Córdoba          37.9 -4.78 
##  2 Zaragoza         41.6 -0.883
##  3 Murcia           38.0 -1.13 
##  4 Sevilla          37.4 -5.98 
##  5 Granada          37.2 -3.60 
##  6 Málaga           36.7 -4.42 
##  7 Mallorca (isla)  39.6  2.65 
##  8 Valencia         39.5 -0.375
##  9 Toledo           39.9 -4.03 
## 10 Algeciras        36.1 -5.45 
## 11 Silves           37.2 -8.43 
## 12 Badajoz          38.9 -6.97</code></pre>
<p>Now we need to aggregate all locations with these magnets. A way to do that is to calculate the distance between all the places and these magnets. (BTW, feel free to change this list!). In the code below we will connect our <code>PUA$lugar</code> with our magnets (<code>imanes</code>) in such a way that each place in our table will get joined with each and every magnet.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="modeling-complex-entities.html#cb5-1" tabindex="-1"></a>lugares_con_imanes <span class="ot">&lt;-</span> PUA<span class="sc">$</span>lugar <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="modeling-complex-entities.html#cb5-2" tabindex="-1"></a>  <span class="fu">merge</span>(imanes, <span class="at">by =</span> <span class="cn">NULL</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="modeling-complex-entities.html#cb5-3" tabindex="-1"></a>  <span class="co"># REMOVE ALL PLACES WITH NA</span></span>
<span id="cb5-4"><a href="modeling-complex-entities.html#cb5-4" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(lat)) <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="modeling-complex-entities.html#cb5-5" tabindex="-1"></a>  <span class="fu">filter</span>(FLAG_alandalus <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="modeling-complex-entities.html#cb5-6" tabindex="-1"></a>  <span class="fu">arrange</span>(idLugar) <span class="sc">%&gt;%</span></span>
<span id="cb5-7"><a href="modeling-complex-entities.html#cb5-7" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>notas, <span class="sc">-</span>descripcion)</span>
<span id="cb5-8"><a href="modeling-complex-entities.html#cb5-8" tabindex="-1"></a></span>
<span id="cb5-9"><a href="modeling-complex-entities.html#cb5-9" tabindex="-1"></a>lugares_con_imanes <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(lugares_con_imanes)</span>
<span id="cb5-10"><a href="modeling-complex-entities.html#cb5-10" tabindex="-1"></a></span>
<span id="cb5-11"><a href="modeling-complex-entities.html#cb5-11" tabindex="-1"></a>lugares_con_imanes</span></code></pre></div>
<pre><code>## # A tibble: 4,764 × 9
##    idLugar FLAG_alandalus nombre nombre_castellano   lat   lng region           latR   lngR
##      &lt;dbl&gt;          &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;
##  1       4              1 قرطبة  Córdoba            37.9 -4.78 Córdoba          37.9 -4.78 
##  2       4              1 قرطبة  Córdoba            37.9 -4.78 Zaragoza         41.6 -0.883
##  3       4              1 قرطبة  Córdoba            37.9 -4.78 Murcia           38.0 -1.13 
##  4       4              1 قرطبة  Córdoba            37.9 -4.78 Sevilla          37.4 -5.98 
##  5       4              1 قرطبة  Córdoba            37.9 -4.78 Granada          37.2 -3.60 
##  6       4              1 قرطبة  Córdoba            37.9 -4.78 Málaga           36.7 -4.42 
##  7       4              1 قرطبة  Córdoba            37.9 -4.78 Mallorca (isla)  39.6  2.65 
##  8       4              1 قرطبة  Córdoba            37.9 -4.78 Valencia         39.5 -0.375
##  9       4              1 قرطبة  Córdoba            37.9 -4.78 Toledo           39.9 -4.03 
## 10       4              1 قرطبة  Córdoba            37.9 -4.78 Algeciras        36.1 -5.45 
## # ℹ 4,754 more rows</code></pre>
<p>Now, we need a way to calculate distances between the places. The issue here is that we need to use a special complex formula that would allow us to calculate the length of so-called “great circles” (or arcs), which is the shortest distance over the earth’s surface, giving “as-the-crow-flies” distance between each pair of points. For that we need to use the <a href="https://en.wikipedia.org/wiki/Haversine_formula">Haversine formula</a>. We can write a function that would do the calculations and then apply it to the table.
This is where ChatGPT can be very helpful, since you can ask it to implement the formula in R:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="modeling-complex-entities.html#cb7-1" tabindex="-1"></a><span class="co"># Haversine function to calculate distance between two coordinates</span></span>
<span id="cb7-2"><a href="modeling-complex-entities.html#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="modeling-complex-entities.html#cb7-3" tabindex="-1"></a>haversine <span class="ot">&lt;-</span> <span class="cf">function</span>(long1, lat1, long2, lat2) {</span>
<span id="cb7-4"><a href="modeling-complex-entities.html#cb7-4" tabindex="-1"></a>  <span class="co"># Convert degrees to radians</span></span>
<span id="cb7-5"><a href="modeling-complex-entities.html#cb7-5" tabindex="-1"></a>  long1 <span class="ot">&lt;-</span> long1 <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span></span>
<span id="cb7-6"><a href="modeling-complex-entities.html#cb7-6" tabindex="-1"></a>  lat1 <span class="ot">&lt;-</span> lat1 <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span></span>
<span id="cb7-7"><a href="modeling-complex-entities.html#cb7-7" tabindex="-1"></a>  long2 <span class="ot">&lt;-</span> long2 <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span></span>
<span id="cb7-8"><a href="modeling-complex-entities.html#cb7-8" tabindex="-1"></a>  lat2 <span class="ot">&lt;-</span> lat2 <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span></span>
<span id="cb7-9"><a href="modeling-complex-entities.html#cb7-9" tabindex="-1"></a></span>
<span id="cb7-10"><a href="modeling-complex-entities.html#cb7-10" tabindex="-1"></a>  <span class="co"># Haversine formula</span></span>
<span id="cb7-11"><a href="modeling-complex-entities.html#cb7-11" tabindex="-1"></a>  dlon <span class="ot">&lt;-</span> long2 <span class="sc">-</span> long1</span>
<span id="cb7-12"><a href="modeling-complex-entities.html#cb7-12" tabindex="-1"></a>  dlat <span class="ot">&lt;-</span> lat2 <span class="sc">-</span> lat1</span>
<span id="cb7-13"><a href="modeling-complex-entities.html#cb7-13" tabindex="-1"></a>  a <span class="ot">&lt;-</span> <span class="fu">sin</span>(dlat <span class="sc">/</span> <span class="dv">2</span>)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">cos</span>(lat1) <span class="sc">*</span> <span class="fu">cos</span>(lat2) <span class="sc">*</span> <span class="fu">sin</span>(dlon <span class="sc">/</span> <span class="dv">2</span>)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb7-14"><a href="modeling-complex-entities.html#cb7-14" tabindex="-1"></a>  c <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">atan2</span>(<span class="fu">sqrt</span>(a), <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">-</span> a))</span>
<span id="cb7-15"><a href="modeling-complex-entities.html#cb7-15" tabindex="-1"></a></span>
<span id="cb7-16"><a href="modeling-complex-entities.html#cb7-16" tabindex="-1"></a>  <span class="co"># Radius of the earth in kilometers</span></span>
<span id="cb7-17"><a href="modeling-complex-entities.html#cb7-17" tabindex="-1"></a>  r <span class="ot">&lt;-</span> <span class="fl">6371.0</span></span>
<span id="cb7-18"><a href="modeling-complex-entities.html#cb7-18" tabindex="-1"></a></span>
<span id="cb7-19"><a href="modeling-complex-entities.html#cb7-19" tabindex="-1"></a>  <span class="co"># Distance in kilometers</span></span>
<span id="cb7-20"><a href="modeling-complex-entities.html#cb7-20" tabindex="-1"></a>  <span class="fu">return</span>(r <span class="sc">*</span> c)</span>
<span id="cb7-21"><a href="modeling-complex-entities.html#cb7-21" tabindex="-1"></a>}</span></code></pre></div>
<blockquote>
<p><strong>Note:</strong> since ChatGPT is a generative model, it will always try to give you some answer, but it does not mean that the answer will be correct. One should always keep this in mind and cross-examine ChatGPT results. In this specific case we can simply google distances between specific places and check how close those results are to what we have calculated with the ChatGPT-provided function. One other thing to keep in mind: ChatGPT often tries to use some libraries as shortcuts to solving specific problems, but this approach tends to fail quite often with R. For example, ChatGPT initially suggested code that uses some obscure R library—and it did not work. Instead I asked to implement the Harvestine formula from scratch and wrap it into a function that can be reused.</p>
</blockquote>
<p>Now, let’s calculate these distances in our data and pick the closest graviton (i.e., a prominent location for which we have the shortest distance):</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="modeling-complex-entities.html#cb8-1" tabindex="-1"></a>lugares_con_imanes_ultimas <span class="ot">&lt;-</span> lugares_con_imanes <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="modeling-complex-entities.html#cb8-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">distancia =</span> <span class="fu">haversine</span>(lng, lat, lngR, latR)) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="modeling-complex-entities.html#cb8-3" tabindex="-1"></a>  <span class="fu">group_by</span>(idLugar) <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="modeling-complex-entities.html#cb8-4" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="at">wt =</span> distancia)</span>
<span id="cb8-5"><a href="modeling-complex-entities.html#cb8-5" tabindex="-1"></a></span>
<span id="cb8-6"><a href="modeling-complex-entities.html#cb8-6" tabindex="-1"></a>lugares_con_imanes_ultimas</span></code></pre></div>
<pre><code>## # A tibble: 397 × 10
## # Groups:   idLugar [397]
##    idLugar FLAG_alandalus nombre    nombre_castellano   lat    lng region     latR   lngR distancia
##      &lt;dbl&gt;          &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;             &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;
##  1       4              1 قرطبة     Córdoba            37.9 -4.78  Córdoba    37.9 -4.78        0  
##  2       6              1 إلبيرة    Elvira             37.2 -3.71  Granada    37.2 -3.60       11.2
##  3       7              1 قلعة يحصب Alcalá la Real     37.4 -3.95  Granada    37.2 -3.60       42.6
##  4       8              1 شذونة     Sidonia            36.5 -5.93  Algeciras  36.1 -5.45       55.7
##  5      10              1 سرقسطة    Zaragoza           41.6 -0.883 Zaragoza   41.6 -0.883       0  
##  6      15              1 أشونة     Osuna              37.2 -5.10  Córdoba    37.9 -4.78       77.8
##  7      17              1 جزيرة شقر Alcira             39.2 -0.435 Valencia   39.5 -0.375      35.6
##  8      18              1 مرسية     Murcia             38.0 -1.13  Murcia     38.0 -1.13        0  
##  9      19              1 شاطبة     Játiva             39.0 -0.519 Valencia   39.5 -0.375      54.6
## 10      20              1 إشبيلية   Sevilla            37.4 -5.98  Sevilla    37.4 -5.98        0  
## # ℹ 387 more rows</code></pre>
<p>Keep in mind that this is not necessarily intended to be the final version. You can play around with this data and manually move some locations from one region to another; you can also include other “magnets” and re-classify all places.</p>
<p>Let’s now try to visualize these regions:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="modeling-complex-entities.html#cb10-1" tabindex="-1"></a>modeledAndalusianRegions <span class="ot">&lt;-</span> base_plot_andalus_themed <span class="sc">+</span> </span>
<span id="cb10-2"><a href="modeling-complex-entities.html#cb10-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> lugares_con_imanes_ultimas,</span>
<span id="cb10-3"><a href="modeling-complex-entities.html#cb10-3" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> lng, <span class="at">y =</span> lat, <span class="at">col =</span> region),</span>
<span id="cb10-4"><a href="modeling-complex-entities.html#cb10-4" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.85</span>)</span>
<span id="cb10-5"><a href="modeling-complex-entities.html#cb10-5" tabindex="-1"></a></span>
<span id="cb10-6"><a href="modeling-complex-entities.html#cb10-6" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;PUAR_Cl10_Map01.png&quot;</span>, <span class="at">plot =</span> modeledAndalusianRegions,</span>
<span id="cb10-7"><a href="modeling-complex-entities.html#cb10-7" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">200</span>, <span class="at">height =</span> <span class="dv">150</span>, <span class="at">units =</span> <span class="st">&quot;mm&quot;</span>, <span class="at">dpi =</span> <span class="st">&quot;retina&quot;</span>)</span>
<span id="cb10-8"><a href="modeling-complex-entities.html#cb10-8" tabindex="-1"></a></span>
<span id="cb10-9"><a href="modeling-complex-entities.html#cb10-9" tabindex="-1"></a>modeledAndalusianRegions</span></code></pre></div>
<p><img src="handbook_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Now, we can use <code>lugares_con_imanes_ultimas</code> instead of <code>PUA$lugar</code> to group multiple locations into our modeled regions.</p>
<p>By the way, we can save this data back into our <code>PUA</code> data and reuse it later. But let’s keep the original file intact, just in case.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="modeling-complex-entities.html#cb11-1" tabindex="-1"></a>PUA<span class="sc">$</span>lugares_con_imanes <span class="ot">&lt;-</span> lugares_con_imanes_ultimas</span>
<span id="cb11-2"><a href="modeling-complex-entities.html#cb11-2" tabindex="-1"></a><span class="fu">saveRDS</span>(PUA, <span class="st">&quot;./data/PUA_processed/PUA_allDataTables_asList_UPDATED.rds&quot;</span>)</span></code></pre></div>
</div>
<div id="modeling-periods" class="section level2 hasAnchor" number="12.2">
<h2><span class="header-section-number">12.2</span> Modeling Periods<a href="modeling-complex-entities.html#modeling-periods" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Another important task that we may want to consider is modifying our data in such a way that individuals would be included not only into a specific decade when they died, but rather into all the decades when they lived. Here we have a bit of a problem. For some individuals we have both birth and death dates, so there we can easily get their life spans. What do we do with others for whom we know only death dates?</p>
<p>There is a variety of ways we can go about this issue. We will try the following: for every individual without date of birth (or age), we will assign a life span by randomly sampling ages that we have in the data.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="modeling-complex-entities.html#cb12-1" tabindex="-1"></a>ages <span class="ot">&lt;-</span> PUA<span class="sc">$</span>personaje <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="modeling-complex-entities.html#cb12-2" tabindex="-1"></a>  <span class="fu">filter</span>(edad <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="modeling-complex-entities.html#cb12-3" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(edad)) <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="modeling-complex-entities.html#cb12-4" tabindex="-1"></a>  <span class="fu">select</span>(edad)</span>
<span id="cb12-5"><a href="modeling-complex-entities.html#cb12-5" tabindex="-1"></a></span>
<span id="cb12-6"><a href="modeling-complex-entities.html#cb12-6" tabindex="-1"></a><span class="fu">length</span>(ages<span class="sc">$</span>edad)</span></code></pre></div>
<pre><code>## [1] 1998</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="modeling-complex-entities.html#cb14-1" tabindex="-1"></a><span class="fu">summary</span>(ages<span class="sc">$</span>edad)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    7.00   62.25   73.00   70.94   80.00  118.00</code></pre>
<p>As we see above, we have age information for about 2,000 individuals.</p>
<p>Now, we want to add some kind of value to age. Actually, we want to create a new column with <code>ifelse</code>:</p>
<ul>
<li>if we have age, we keep it;</li>
<li>else, we add some value;</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="modeling-complex-entities.html#cb16-1" tabindex="-1"></a>PUA_personaje_fechas <span class="ot">&lt;-</span> PUA<span class="sc">$</span>personaje <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="modeling-complex-entities.html#cb16-2" tabindex="-1"></a>  <span class="fu">select</span>(idPersonaje, nacimiento, muerte, edad) <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="modeling-complex-entities.html#cb16-3" tabindex="-1"></a>  <span class="fu">mutate_all</span>(<span class="sc">~</span><span class="fu">replace</span>(., . <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>))</span></code></pre></div>
<p>Now, the question is what value we should add? We can randomly pull age values from our existing data and assign them to individuals who do not have age information. Doing this, we can reproduce the same distribution as we have in the original data.</p>
<p>This is how we can check if we got the distribution right. Essentially, we can visualize both vectors as histograms and check if their shapes are similar or not. If similar, we got the distribution right.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="modeling-complex-entities.html#cb17-1" tabindex="-1"></a>missingAgesNumber <span class="ot">&lt;-</span> PUA_personaje_fechas <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="modeling-complex-entities.html#cb17-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(edad)) <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="modeling-complex-entities.html#cb17-3" tabindex="-1"></a>  <span class="fu">nrow</span>() <span class="co"># 10815 missing ages</span></span>
<span id="cb17-4"><a href="modeling-complex-entities.html#cb17-4" tabindex="-1"></a>  </span>
<span id="cb17-5"><a href="modeling-complex-entities.html#cb17-5" tabindex="-1"></a>agesExisting <span class="ot">&lt;-</span> ages<span class="sc">$</span>edad <span class="co"># 1998 available ages</span></span>
<span id="cb17-6"><a href="modeling-complex-entities.html#cb17-6" tabindex="-1"></a>agesExtrapolated <span class="ot">&lt;-</span> <span class="fu">sample</span>(agesExisting, <span class="at">size =</span> missingAgesNumber, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-7"><a href="modeling-complex-entities.html#cb17-7" tabindex="-1"></a></span>
<span id="cb17-8"><a href="modeling-complex-entities.html#cb17-8" tabindex="-1"></a><span class="co"># now, we visualize two AGE vectors as histograms. Their shapes must be very similar:</span></span>
<span id="cb17-9"><a href="modeling-complex-entities.html#cb17-9" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb17-10"><a href="modeling-complex-entities.html#cb17-10" tabindex="-1"></a><span class="fu">hist</span>(agesExisting)</span>
<span id="cb17-11"><a href="modeling-complex-entities.html#cb17-11" tabindex="-1"></a><span class="fu">hist</span>(agesExtrapolated)</span></code></pre></div>
<p><img src="handbook_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="modeling-complex-entities.html#cb18-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code></pre></div>
<p>We can also run <code>summary()</code> on both vectors. As you can see, our extrapolated vector is just a teeny-tiny bit different.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="modeling-complex-entities.html#cb19-1" tabindex="-1"></a><span class="fu">summary</span>(agesExisting)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    7.00   62.25   73.00   70.94   80.00  118.00</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="modeling-complex-entities.html#cb21-1" tabindex="-1"></a><span class="fu">summary</span>(agesExtrapolated)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    7.00   63.00   73.00   71.25   81.00  118.00</code></pre>
<p>A better way may be to apply this period by period, for example going by 100-year time spans. This way we can also get the chronological distribution with more nuance.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="modeling-complex-entities.html#cb23-1" tabindex="-1"></a>agesByAges <span class="ot">&lt;-</span> PUA_personaje_fechas <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="modeling-complex-entities.html#cb23-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(edad)) <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="modeling-complex-entities.html#cb23-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">century =</span> <span class="fu">ceiling</span>(<span class="fu">as.numeric</span>(muerte <span class="sc">/</span> <span class="dv">100</span>)) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb23-4"><a href="modeling-complex-entities.html#cb23-4" tabindex="-1"></a></span>
<span id="cb23-5"><a href="modeling-complex-entities.html#cb23-5" tabindex="-1"></a>valuesPerCentury <span class="ot">&lt;-</span> agesByAges <span class="sc">%&gt;%</span></span>
<span id="cb23-6"><a href="modeling-complex-entities.html#cb23-6" tabindex="-1"></a>  <span class="fu">group_by</span>(century) <span class="sc">%&gt;%</span></span>
<span id="cb23-7"><a href="modeling-complex-entities.html#cb23-7" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb23-8"><a href="modeling-complex-entities.html#cb23-8" tabindex="-1"></a></span>
<span id="cb23-9"><a href="modeling-complex-entities.html#cb23-9" tabindex="-1"></a><span class="fu">ggplot</span>(agesByAges, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(century), <span class="at">y =</span> edad)) <span class="sc">+</span></span>
<span id="cb23-10"><a href="modeling-complex-entities.html#cb23-10" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb23-11"><a href="modeling-complex-entities.html#cb23-11" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Century&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Age at Death&quot;</span>) <span class="sc">+</span></span>
<span id="cb23-12"><a href="modeling-complex-entities.html#cb23-12" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()  <span class="co"># Optional: Apply a minimal theme</span></span></code></pre></div>
<p><img src="handbook_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>But let’s go with the simpler approach. Let’s extrapolate ages:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="modeling-complex-entities.html#cb24-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">786</span>)</span>
<span id="cb24-2"><a href="modeling-complex-entities.html#cb24-2" tabindex="-1"></a>agesExtrapolated <span class="ot">&lt;-</span> <span class="fu">sample</span>(agesExisting, <span class="at">size =</span> missingAgesNumber, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb24-3"><a href="modeling-complex-entities.html#cb24-3" tabindex="-1"></a></span>
<span id="cb24-4"><a href="modeling-complex-entities.html#cb24-4" tabindex="-1"></a>PUA_personaje_fechas_modelled <span class="ot">&lt;-</span> PUA_personaje_fechas <span class="sc">%&gt;%</span></span>
<span id="cb24-5"><a href="modeling-complex-entities.html#cb24-5" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(edad)) <span class="sc">%&gt;%</span></span>
<span id="cb24-6"><a href="modeling-complex-entities.html#cb24-6" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">edad_extrapolated =</span> agesExtrapolated)</span>
<span id="cb24-7"><a href="modeling-complex-entities.html#cb24-7" tabindex="-1"></a></span>
<span id="cb24-8"><a href="modeling-complex-entities.html#cb24-8" tabindex="-1"></a>PUA_personaje_fechas_existing <span class="ot">&lt;-</span> PUA_personaje_fechas <span class="sc">%&gt;%</span></span>
<span id="cb24-9"><a href="modeling-complex-entities.html#cb24-9" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(edad)) <span class="sc">%&gt;%</span></span>
<span id="cb24-10"><a href="modeling-complex-entities.html#cb24-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">edad_extrapolated =</span> edad)</span>
<span id="cb24-11"><a href="modeling-complex-entities.html#cb24-11" tabindex="-1"></a></span>
<span id="cb24-12"><a href="modeling-complex-entities.html#cb24-12" tabindex="-1"></a></span>
<span id="cb24-13"><a href="modeling-complex-entities.html#cb24-13" tabindex="-1"></a>PUA_personaje_decadas <span class="ot">&lt;-</span> PUA_personaje_fechas_modelled <span class="sc">%&gt;%</span></span>
<span id="cb24-14"><a href="modeling-complex-entities.html#cb24-14" tabindex="-1"></a>  <span class="fu">add_row</span>(PUA_personaje_fechas_existing) <span class="sc">%&gt;%</span></span>
<span id="cb24-15"><a href="modeling-complex-entities.html#cb24-15" tabindex="-1"></a>  <span class="fu">arrange</span>(idPersonaje) <span class="sc">%&gt;%</span></span>
<span id="cb24-16"><a href="modeling-complex-entities.html#cb24-16" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(muerte)) <span class="sc">%&gt;%</span></span>
<span id="cb24-17"><a href="modeling-complex-entities.html#cb24-17" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nacimiento1 =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(nacimiento), nacimiento, muerte <span class="sc">-</span> edad_extrapolated)) <span class="sc">%&gt;%</span></span>
<span id="cb24-18"><a href="modeling-complex-entities.html#cb24-18" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">decada_n =</span> <span class="fu">ceiling</span>(<span class="fu">as.numeric</span>(nacimiento1 <span class="sc">/</span> <span class="dv">10</span>)) <span class="sc">*</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-19"><a href="modeling-complex-entities.html#cb24-19" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">decada_m =</span> <span class="fu">ceiling</span>(<span class="fu">as.numeric</span>(muerte <span class="sc">/</span> <span class="dv">10</span>)) <span class="sc">*</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-20"><a href="modeling-complex-entities.html#cb24-20" tabindex="-1"></a>  <span class="fu">select</span>(idPersonaje, decada_n, decada_m) <span class="sc">%&gt;%</span></span>
<span id="cb24-21"><a href="modeling-complex-entities.html#cb24-21" tabindex="-1"></a>  <span class="fu">group_by</span>(idPersonaje) <span class="sc">%&gt;%</span></span>
<span id="cb24-22"><a href="modeling-complex-entities.html#cb24-22" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">decadas =</span> <span class="fu">list</span>(<span class="fu">seq</span>(<span class="at">from =</span> decada_n, <span class="at">to =</span> decada_m, <span class="at">by =</span> <span class="dv">10</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb24-23"><a href="modeling-complex-entities.html#cb24-23" tabindex="-1"></a>  <span class="fu">unnest</span>(decadas)</span>
<span id="cb24-24"><a href="modeling-complex-entities.html#cb24-24" tabindex="-1"></a></span>
<span id="cb24-25"><a href="modeling-complex-entities.html#cb24-25" tabindex="-1"></a>PUA_personaje_decadas</span></code></pre></div>
<pre><code>## # A tibble: 56,166 × 2
##    idPersonaje decadas
##          &lt;dbl&gt;   &lt;dbl&gt;
##  1           1     120
##  2           1     130
##  3           1     140
##  4           1     150
##  5           1     160
##  6           1     170
##  7           1     180
##  8           7     350
##  9           7     360
## 10           7     370
## # ℹ 56,156 more rows</code></pre>
<p>Now, let’s compare two graphs: the graph of people when we do it only by their death dates, and another — where we consider people who is alive in those decades:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="modeling-complex-entities.html#cb26-1" tabindex="-1"></a>muerte_decadas <span class="ot">&lt;-</span> PUA_personaje_fechas <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="modeling-complex-entities.html#cb26-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(muerte)) <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="modeling-complex-entities.html#cb26-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">decadas =</span> <span class="fu">ceiling</span>(<span class="fu">as.numeric</span>(muerte <span class="sc">/</span> <span class="dv">10</span>)) <span class="sc">*</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-4"><a href="modeling-complex-entities.html#cb26-4" tabindex="-1"></a>  <span class="fu">group_by</span>(decadas) <span class="sc">%&gt;%</span></span>
<span id="cb26-5"><a href="modeling-complex-entities.html#cb26-5" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb26-6"><a href="modeling-complex-entities.html#cb26-6" tabindex="-1"></a></span>
<span id="cb26-7"><a href="modeling-complex-entities.html#cb26-7" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb26-8"><a href="modeling-complex-entities.html#cb26-8" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> muerte_decadas, <span class="fu">aes</span>(<span class="at">x =</span> decadas, <span class="at">y =</span> count), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb26-9"><a href="modeling-complex-entities.html#cb26-9" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">950</span>)) <span class="sc">+</span></span>
<span id="cb26-10"><a href="modeling-complex-entities.html#cb26-10" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="handbook_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="modeling-complex-entities.html#cb27-1" tabindex="-1"></a>vida_decadas <span class="ot">&lt;-</span> PUA_personaje_decadas <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="modeling-complex-entities.html#cb27-2" tabindex="-1"></a>  <span class="fu">group_by</span>(decadas) <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="modeling-complex-entities.html#cb27-3" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb27-4"><a href="modeling-complex-entities.html#cb27-4" tabindex="-1"></a></span>
<span id="cb27-5"><a href="modeling-complex-entities.html#cb27-5" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb27-6"><a href="modeling-complex-entities.html#cb27-6" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> vida_decadas, <span class="fu">aes</span>(<span class="at">x =</span> decadas, <span class="at">y =</span> count), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb27-7"><a href="modeling-complex-entities.html#cb27-7" tabindex="-1"></a>    <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">950</span>)) <span class="sc">+</span></span>
<span id="cb27-8"><a href="modeling-complex-entities.html#cb27-8" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="handbook_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>As you can see on the graph above, we now have more data—each decade is now much more robust—and a much smoother curve.</p>
<div id="a-1000-and-1-tries" class="section level3 hasAnchor" number="12.2.1">
<h3><span class="header-section-number">12.2.1</span> A 1000 And 1 Tries<a href="modeling-complex-entities.html#a-1000-and-1-tries" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As you can see, with extrapolated ages we have much more data and the graph is much smoother. There is a bit of a problem in our data, however. Since there is quite a lot of generated data, this curve is just one of the possible states. A possible solution to this can be a creation of, say, 1,000 of such distributions and finding some average between them. For this, we essentially will need to loop all the previous steps.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="modeling-complex-entities.html#cb28-1" tabindex="-1"></a>vida_decadas_modelled <span class="ot">&lt;-</span> vida_decadas <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="modeling-complex-entities.html#cb28-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">version =</span> <span class="dv">0</span>, <span class="at">.before =</span> decadas)</span>
<span id="cb28-3"><a href="modeling-complex-entities.html#cb28-3" tabindex="-1"></a></span>
<span id="cb28-4"><a href="modeling-complex-entities.html#cb28-4" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">1000</span>, <span class="dv">1</span>)){</span>
<span id="cb28-5"><a href="modeling-complex-entities.html#cb28-5" tabindex="-1"></a>  <span class="co"># here we do not use set.seed !</span></span>
<span id="cb28-6"><a href="modeling-complex-entities.html#cb28-6" tabindex="-1"></a>  agesExtrapolated <span class="ot">&lt;-</span> <span class="fu">sample</span>(agesExisting, <span class="at">size =</span> missingAgesNumber, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-7"><a href="modeling-complex-entities.html#cb28-7" tabindex="-1"></a></span>
<span id="cb28-8"><a href="modeling-complex-entities.html#cb28-8" tabindex="-1"></a>  PUA_personaje_fechas_modelled <span class="ot">&lt;-</span> PUA_personaje_fechas <span class="sc">%&gt;%</span></span>
<span id="cb28-9"><a href="modeling-complex-entities.html#cb28-9" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">is.na</span>(edad)) <span class="sc">%&gt;%</span></span>
<span id="cb28-10"><a href="modeling-complex-entities.html#cb28-10" tabindex="-1"></a>    <span class="fu">add_column</span>(<span class="at">edad_extrapolated =</span> agesExtrapolated)</span>
<span id="cb28-11"><a href="modeling-complex-entities.html#cb28-11" tabindex="-1"></a></span>
<span id="cb28-12"><a href="modeling-complex-entities.html#cb28-12" tabindex="-1"></a>  PUA_personaje_fechas_existing <span class="ot">&lt;-</span> PUA_personaje_fechas <span class="sc">%&gt;%</span></span>
<span id="cb28-13"><a href="modeling-complex-entities.html#cb28-13" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(edad)) <span class="sc">%&gt;%</span></span>
<span id="cb28-14"><a href="modeling-complex-entities.html#cb28-14" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">edad_extrapolated =</span> edad)</span>
<span id="cb28-15"><a href="modeling-complex-entities.html#cb28-15" tabindex="-1"></a></span>
<span id="cb28-16"><a href="modeling-complex-entities.html#cb28-16" tabindex="-1"></a>  PUA_personaje_decadas <span class="ot">&lt;-</span> PUA_personaje_fechas_modelled <span class="sc">%&gt;%</span></span>
<span id="cb28-17"><a href="modeling-complex-entities.html#cb28-17" tabindex="-1"></a>    <span class="fu">add_row</span>(PUA_personaje_fechas_existing) <span class="sc">%&gt;%</span></span>
<span id="cb28-18"><a href="modeling-complex-entities.html#cb28-18" tabindex="-1"></a>    <span class="fu">arrange</span>(idPersonaje) <span class="sc">%&gt;%</span></span>
<span id="cb28-19"><a href="modeling-complex-entities.html#cb28-19" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(muerte)) <span class="sc">%&gt;%</span></span>
<span id="cb28-20"><a href="modeling-complex-entities.html#cb28-20" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">nacimiento1 =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(nacimiento), nacimiento, muerte <span class="sc">-</span> edad_extrapolated)) <span class="sc">%&gt;%</span></span>
<span id="cb28-21"><a href="modeling-complex-entities.html#cb28-21" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">decada_n =</span> <span class="fu">ceiling</span>(<span class="fu">as.numeric</span>(nacimiento1 <span class="sc">/</span> <span class="dv">10</span>)) <span class="sc">*</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-22"><a href="modeling-complex-entities.html#cb28-22" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">decada_m =</span> <span class="fu">ceiling</span>(<span class="fu">as.numeric</span>(muerte <span class="sc">/</span> <span class="dv">10</span>)) <span class="sc">*</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-23"><a href="modeling-complex-entities.html#cb28-23" tabindex="-1"></a>    <span class="fu">select</span>(idPersonaje, decada_n, decada_m) <span class="sc">%&gt;%</span></span>
<span id="cb28-24"><a href="modeling-complex-entities.html#cb28-24" tabindex="-1"></a>    <span class="fu">group_by</span>(idPersonaje) <span class="sc">%&gt;%</span></span>
<span id="cb28-25"><a href="modeling-complex-entities.html#cb28-25" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">decadas =</span> <span class="fu">list</span>(<span class="fu">seq</span>(<span class="at">from =</span> decada_n, <span class="at">to =</span> decada_m, <span class="at">by =</span> <span class="dv">10</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb28-26"><a href="modeling-complex-entities.html#cb28-26" tabindex="-1"></a>    <span class="fu">unnest</span>(decadas)</span>
<span id="cb28-27"><a href="modeling-complex-entities.html#cb28-27" tabindex="-1"></a></span>
<span id="cb28-28"><a href="modeling-complex-entities.html#cb28-28" tabindex="-1"></a>  vida_decadas_temp <span class="ot">&lt;-</span> PUA_personaje_decadas <span class="sc">%&gt;%</span></span>
<span id="cb28-29"><a href="modeling-complex-entities.html#cb28-29" tabindex="-1"></a>    <span class="fu">group_by</span>(decadas) <span class="sc">%&gt;%</span></span>
<span id="cb28-30"><a href="modeling-complex-entities.html#cb28-30" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb28-31"><a href="modeling-complex-entities.html#cb28-31" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">version =</span> i, <span class="at">.before =</span> decadas)</span>
<span id="cb28-32"><a href="modeling-complex-entities.html#cb28-32" tabindex="-1"></a></span>
<span id="cb28-33"><a href="modeling-complex-entities.html#cb28-33" tabindex="-1"></a>  vida_decadas_modelled <span class="ot">&lt;-</span> vida_decadas_modelled <span class="sc">%&gt;%</span></span>
<span id="cb28-34"><a href="modeling-complex-entities.html#cb28-34" tabindex="-1"></a>    <span class="fu">add_row</span>(vida_decadas_temp)</span>
<span id="cb28-35"><a href="modeling-complex-entities.html#cb28-35" tabindex="-1"></a>}</span></code></pre></div>
<p>Now, let’s graph is and see how 1,000 iterations would be different from a single iteration. Thus, on the graph below we have two lines: 1) a light blue line of varying width, which represents the results of 1,000 iterations; and 2) a black line that represents a single variation.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="modeling-complex-entities.html#cb29-1" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb29-2"><a href="modeling-complex-entities.html#cb29-2" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> vida_decadas_modelled,</span>
<span id="cb29-3"><a href="modeling-complex-entities.html#cb29-3" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> decadas, <span class="at">y =</span> count,</span>
<span id="cb29-4"><a href="modeling-complex-entities.html#cb29-4" tabindex="-1"></a>                <span class="at">group =</span> <span class="fu">as.factor</span>(version)),</span>
<span id="cb29-5"><a href="modeling-complex-entities.html#cb29-5" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb29-6"><a href="modeling-complex-entities.html#cb29-6" tabindex="-1"></a>            <span class="at">col =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb29-7"><a href="modeling-complex-entities.html#cb29-7" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> vida_decadas, <span class="fu">aes</span>(<span class="at">x =</span> decadas, <span class="at">y =</span> count), <span class="at">linewidth =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb29-8"><a href="modeling-complex-entities.html#cb29-8" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">950</span>)) <span class="sc">+</span></span>
<span id="cb29-9"><a href="modeling-complex-entities.html#cb29-9" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb29-10"><a href="modeling-complex-entities.html#cb29-10" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) </span></code></pre></div>
<p><img src="handbook_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>For the most part, the black line seems to be within the range of the blue lines, suggesting that the single extrapolation is not an extreme outlier. There are more robust techniques that can be used to improve this distribution, but for our purposes here we may consider a single extrapolation more or less acceptable. The most important value of this extrapolation is that now for each date we have an estimate of individuals who are alive at that moment in time.</p>
<p>[<strong>#TODO</strong>: other techniques should be discussed, explained, and demonstrated.]</p>
<!--

**NOTE:** a more complex “age assignment” can be done based on sampling ages of different groups, like Cordobans would have one distribution, while jurists may have a different one; a person who is both a Cordoban and a jurist should have their probable age pulled from both samples, perhaps multiple times; then a single age should be pulled randomly from such pools of ages created for each individual. 

-->
<!--

IMPROVEMENTS:

1. Blue Lines: Each blue line represents a possible extrapolation of ages for the 10,000 individuals. Since there are multiple blue lines, we can understand that there are numerous potential age distributions for these individuals based on the knowledge from the 2,000 with known ages.

2. Black Line: This is a single extrapolation, essentially one possible age distribution for the 10,000 individuals.

Given this understanding, you want to determine if a single extrapolation (the black line) is representative enough or if it falls within the general range of the 10,000 extrapolations (the blue lines).

Here are some suggestions and observations:

1. Visual Inspection:

- For the most part, the black line seems to be within the range of the blue lines, suggesting that the single extrapolation is not an extreme outlier. However, there are periods (like the middle of the x-axis) where the black line falls outside the densest region of the blue lines, indicating potential divergence.

2. Statistical Analysis:

- To quantitatively determine the "acceptability" of the black line, you might consider calculating summary statistics (mean, median, standard deviation, etc.) for each period across the 10,000 blue lines. This will provide a range (confidence interval) for each period. You can then check if the black line's value for each period falls within this range.
If you find that the black line frequently falls outside these ranges, it might suggest that a single extrapolation might not be representative.

3. Smoothing:

- Consider applying a smoothing function (like a moving average) to the lines to better visualize trends and reduce noise. This can help in more easily identifying periods where the single extrapolation diverges from the majority.

4. Shading:

- Using shading (or a ribbon) to indicate the range between, for example, the 5th and 95th percentiles of the blue lines can visually show where most of the extrapolations lie. This can provide a clear visual cue to assess if the black line is within this range.

5. Sampling More:

- If computational resources allow, consider performing more than one single extrapolation (perhaps 100 or 1,000) and see how often they fall within the general range of the 10,000 extrapolations. This can give you a better idea of the variability of single extrapolations.

6. Domain Knowledge:

- Consult with experts in the domain or field to understand if there are specific periods or reasons why the extrapolation might diverge. Sometimes, there might be historical or contextual reasons for such deviations.
In conclusion, while visual inspection can provide some insights, combining it with quantitative analyses will give you a more comprehensive understanding of the acceptability of the single extrapolation.

-->
<p>Another approach that we can potentially try is “moving sum”. We can use the <code>zoo</code> package—a versatile package for working with time series data. (Make sure to install it first!). Let’s try to apply the moving sum for 3, 5, 7, 8, and 9 decades—and check how the results may look. <strong>Note:</strong> <code>align = "left"</code> means that the current value is summed with the values from the next X decades.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="modeling-complex-entities.html#cb30-1" tabindex="-1"></a><span class="fu">library</span>(zoo)</span>
<span id="cb30-2"><a href="modeling-complex-entities.html#cb30-2" tabindex="-1"></a></span>
<span id="cb30-3"><a href="modeling-complex-entities.html#cb30-3" tabindex="-1"></a>alignValue <span class="ot">&lt;-</span> <span class="st">&quot;left&quot;</span></span>
<span id="cb30-4"><a href="modeling-complex-entities.html#cb30-4" tabindex="-1"></a></span>
<span id="cb30-5"><a href="modeling-complex-entities.html#cb30-5" tabindex="-1"></a>muerte_decadas_MA <span class="ot">&lt;-</span> muerte_decadas <span class="sc">%&gt;%</span></span>
<span id="cb30-6"><a href="modeling-complex-entities.html#cb30-6" tabindex="-1"></a>  <span class="fu">arrange</span>(decadas) <span class="sc">%&gt;%</span></span>
<span id="cb30-7"><a href="modeling-complex-entities.html#cb30-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">moving_sum_3 =</span> <span class="fu">rollsum</span>(count, <span class="at">k =</span> <span class="dv">3</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> alignValue)) <span class="sc">%&gt;%</span></span>
<span id="cb30-8"><a href="modeling-complex-entities.html#cb30-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">moving_sum_5 =</span> <span class="fu">rollsum</span>(count, <span class="at">k =</span> <span class="dv">5</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> alignValue)) <span class="sc">%&gt;%</span></span>
<span id="cb30-9"><a href="modeling-complex-entities.html#cb30-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">moving_sum_7 =</span> <span class="fu">rollsum</span>(count, <span class="at">k =</span> <span class="dv">7</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> alignValue)) <span class="sc">%&gt;%</span></span>
<span id="cb30-10"><a href="modeling-complex-entities.html#cb30-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">moving_sum_8 =</span> <span class="fu">rollsum</span>(count, <span class="at">k =</span> <span class="dv">8</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> alignValue)) <span class="sc">%&gt;%</span></span>
<span id="cb30-11"><a href="modeling-complex-entities.html#cb30-11" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">moving_sum_9 =</span> <span class="fu">rollsum</span>(count, <span class="at">k =</span> <span class="dv">9</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> alignValue)) <span class="sc">%&gt;%</span></span>
<span id="cb30-12"><a href="modeling-complex-entities.html#cb30-12" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">!</span>decadas, <span class="at">names_to =</span> <span class="st">&quot;types&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;values&quot;</span>)</span>
<span id="cb30-13"><a href="modeling-complex-entities.html#cb30-13" tabindex="-1"></a></span>
<span id="cb30-14"><a href="modeling-complex-entities.html#cb30-14" tabindex="-1"></a>muerte_decadas_MA</span></code></pre></div>
<pre><code>## # A tibble: 504 × 3
##    decadas types        values
##      &lt;dbl&gt; &lt;chr&gt;         &lt;int&gt;
##  1     100 count            13
##  2     100 moving_sum_3     22
##  3     100 moving_sum_5     44
##  4     100 moving_sum_7     50
##  5     100 moving_sum_8     51
##  6     100 moving_sum_9     76
##  7     110 count             5
##  8     110 moving_sum_3     19
##  9     110 moving_sum_5     34
## 10     110 moving_sum_7     38
## # ℹ 494 more rows</code></pre>
<p>The following code will give us a visualization, which will help us to check the results:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="modeling-complex-entities.html#cb32-1" tabindex="-1"></a><span class="fu">ggplot</span>(muerte_decadas_MA) <span class="sc">+</span></span>
<span id="cb32-2"><a href="modeling-complex-entities.html#cb32-2" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">data =</span> vida_decadas_modelled,</span>
<span id="cb32-3"><a href="modeling-complex-entities.html#cb32-3" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> decadas, <span class="at">y =</span> count,</span>
<span id="cb32-4"><a href="modeling-complex-entities.html#cb32-4" tabindex="-1"></a>                <span class="at">group =</span> <span class="fu">as.factor</span>(version)),</span>
<span id="cb32-5"><a href="modeling-complex-entities.html#cb32-5" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb32-6"><a href="modeling-complex-entities.html#cb32-6" tabindex="-1"></a>            <span class="at">col =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb32-7"><a href="modeling-complex-entities.html#cb32-7" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> decadas, <span class="at">y =</span> values, <span class="at">col =</span> types), <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb32-8"><a href="modeling-complex-entities.html#cb32-8" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> vida_decadas, <span class="fu">aes</span>(<span class="at">x =</span> decadas, <span class="at">y =</span> count), <span class="at">linewidth =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb32-9"><a href="modeling-complex-entities.html#cb32-9" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">950</span>)) <span class="sc">+</span></span>
<span id="cb32-10"><a href="modeling-complex-entities.html#cb32-10" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="handbook_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>The rolling summary of 8 decades gives us a curve which is most close to the our modeled curve. However, here we can see that results of the “moving sum” are much more extreme, often leaving the zone of 1,000 extrapolation curves. Keeping this in mind, our age-based extrapolated curve is a better fit. Additionally, our age-based model gives us more flexibility, since the data here is highly detailed (for each individual), while the “rolling sum” approach only gives us cumulative numbers for each decade.</p>
</div>
</div>
<div id="intermediate-summary" class="section level2 hasAnchor" number="12.3">
<h2><span class="header-section-number">12.3</span> Intermediate Summary<a href="modeling-complex-entities.html#intermediate-summary" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now we have two important datasets that we can use for further analysis:</p>
<ul>
<li>we have modeled regions of al-Andalus, which will allow us to aggregate data;</li>
<li>we have extrapolated chronological data, which will give us more dense chronological snapshots;</li>
</ul>
<p>We can save both tables into our updated PUA dataset:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="modeling-complex-entities.html#cb33-1" tabindex="-1"></a>PUA <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;./data/PUA_processed/PUA_allDataTables_asList.rds&quot;</span>)</span>
<span id="cb33-2"><a href="modeling-complex-entities.html#cb33-2" tabindex="-1"></a></span>
<span id="cb33-3"><a href="modeling-complex-entities.html#cb33-3" tabindex="-1"></a>PUA<span class="sc">$</span>lugar_con_imanes <span class="ot">&lt;-</span> lugares_con_imanes_ultimas</span>
<span id="cb33-4"><a href="modeling-complex-entities.html#cb33-4" tabindex="-1"></a>PUA<span class="sc">$</span>personaje_decadas_modeladas <span class="ot">&lt;-</span> PUA_personaje_decadas</span>
<span id="cb33-5"><a href="modeling-complex-entities.html#cb33-5" tabindex="-1"></a></span>
<span id="cb33-6"><a href="modeling-complex-entities.html#cb33-6" tabindex="-1"></a><span class="fu">saveRDS</span>(PUA, <span class="st">&quot;./data/PUA_processed/PUA_allDataTables_asList_UPDATED.rds&quot;</span>)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="understanding-geographical-maps.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chronological-cartograpms.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "github"]
},
"fontsettings": {
"theme": "white",
"family": "serif",
"size": 2
},
"edit": {
"link": "https://github.com/eis1600/hdis-audition-statements/edit/main/110-Class11.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/eis1600/hdis-audition-statements/blob/main/110-Class11.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"info": true
});
});
</script>

</body>

</html>
