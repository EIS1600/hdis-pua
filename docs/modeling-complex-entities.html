<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>12 Modeling Complex Entities | HDIS: Analysis of Prosopographical Data–with R</title>
  <meta name="description" content="This is a Handbook for Digital Islamicate Studies. Work in progress, based on tought courses." />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="12 Modeling Complex Entities | HDIS: Analysis of Prosopographical Data–with R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a Handbook for Digital Islamicate Studies. Work in progress, based on tought courses." />
  <meta name="github-repo" content="EIS1600/hdis-pua" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="12 Modeling Complex Entities | HDIS: Analysis of Prosopographical Data–with R" />
  
  <meta name="twitter:description" content="This is a Handbook for Digital Islamicate Studies. Work in progress, based on tought courses." />
  

<meta name="author" content="Maxim G. Romanov" />


<meta name="date" content="2023-10-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="touch-icon.png" />
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="prev" href="geographical-maps-cartograms.html"/>
<link rel="next" href="class-12.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="libs/d3-3.3.8/d3.min.js"></script>
<script src="libs/dagre-0.4.0/dagre-d3.min.js"></script>
<link href="libs/mermaid-0.3.0/dist/mermaid.css" rel="stylesheet" />
<script src="libs/mermaid-0.3.0/dist/mermaid.slim.min.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/chromatography-0.1/chromatography.js"></script>
<script src="libs/DiagrammeR-binding-1.0.10/DiagrammeR.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Handbook of Digital Islamicate Studies</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="about-the-course.html"><a href="about-the-course.html"><i class="fa fa-check"></i>About the Course</a>
<ul>
<li class="chapter" data-level="" data-path="about-the-course.html"><a href="about-the-course.html#syllabus"><i class="fa fa-check"></i>Syllabus</a>
<ul>
<li class="chapter" data-level="" data-path="about-the-course.html"><a href="about-the-course.html#general-description"><i class="fa fa-check"></i>General Description</a></li>
<li class="chapter" data-level="" data-path="about-the-course.html"><a href="about-the-course.html#learning-objectives"><i class="fa fa-check"></i>Learning objectives</a></li>
<li class="chapter" data-level="" data-path="about-the-course.html"><a href="about-the-course.html#didactic-concept"><i class="fa fa-check"></i>Didactic concept</a></li>
<li class="chapter" data-level="0.0.1" data-path="about-the-course.html"><a href="about-the-course.html#course-structure-and-learning-objectives"><i class="fa fa-check"></i><b>0.0.1</b> Course structure and learning objectives:</a></li>
<li class="chapter" data-level="0.0.2" data-path="about-the-course.html"><a href="about-the-course.html#main-object-of-the-course-pua-dataset"><i class="fa fa-check"></i><b>0.0.2</b> Main Object of the Course: PUA Dataset</a></li>
<li class="chapter" data-level="" data-path="about-the-course.html"><a href="about-the-course.html#course-evaluation-requirements-for-the-full-credit"><i class="fa fa-check"></i>Course Evaluation: requirements for the full credit</a></li>
<li class="chapter" data-level="" data-path="about-the-course.html"><a href="about-the-course.html#class-participation"><i class="fa fa-check"></i>Class Participation</a></li>
<li class="chapter" data-level="" data-path="about-the-course.html"><a href="about-the-course.html#homework"><i class="fa fa-check"></i>Homework</a></li>
<li class="chapter" data-level="" data-path="about-the-course.html"><a href="about-the-course.html#final-project"><i class="fa fa-check"></i>Final Project</a></li>
<li class="chapter" data-level="" data-path="about-the-course.html"><a href="about-the-course.html#additional-study-materials"><i class="fa fa-check"></i>Additional Study Materials</a></li>
<li class="chapter" data-level="" data-path="about-the-course.html"><a href="about-the-course.html#software-tools-technologies"><i class="fa fa-check"></i>Software, Tools, &amp; Technologies:</a></li>
<li class="chapter" data-level="" data-path="about-the-course.html"><a href="about-the-course.html#submitting-homework"><i class="fa fa-check"></i>Submitting Homework:</a></li>
<li class="chapter" data-level="" data-path="about-the-course.html"><a href="about-the-course.html#lesson-topics-subject-to-modifications"><i class="fa fa-check"></i>Lesson Topics (<em>subject to modifications</em>)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="setting-everything-up.html"><a href="setting-everything-up.html"><i class="fa fa-check"></i><b>1</b> Setting Everything Up</a>
<ul>
<li class="chapter" data-level="1.1" data-path="setting-everything-up.html"><a href="setting-everything-up.html#links-for-things-to-install"><i class="fa fa-check"></i><b>1.1</b> Links for things to install</a></li>
<li class="chapter" data-level="1.2" data-path="setting-everything-up.html"><a href="setting-everything-up.html#setting-things-up"><i class="fa fa-check"></i><b>1.2</b> Setting Things Up</a></li>
<li class="chapter" data-level="1.3" data-path="setting-everything-up.html"><a href="setting-everything-up.html#creating-a-project"><i class="fa fa-check"></i><b>1.3</b> Creating a Project</a></li>
<li class="chapter" data-level="1.4" data-path="setting-everything-up.html"><a href="setting-everything-up.html#homework-assignments"><i class="fa fa-check"></i><b>1.4</b> Homework assignments</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html"><i class="fa fa-check"></i><b>2</b> RStudio, Basic R Commands, Swirl Tutorials</a>
<ul>
<li class="chapter" data-level="2.1" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html#this-chapter"><i class="fa fa-check"></i><b>2.1</b> This Chapter</a></li>
<li class="chapter" data-level="2.2" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html#overview-of-r"><i class="fa fa-check"></i><b>2.2</b> Overview of R</a></li>
<li class="chapter" data-level="2.3" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html#rstudio-interface"><i class="fa fa-check"></i><b>2.3</b> RStudio Interface</a></li>
<li class="chapter" data-level="2.4" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html#main-file-types"><i class="fa fa-check"></i><b>2.4</b> Main File Types</a></li>
<li class="chapter" data-level="2.5" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html#projects"><i class="fa fa-check"></i><b>2.5</b> Projects</a></li>
<li class="chapter" data-level="2.6" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html#basic-commands"><i class="fa fa-check"></i><b>2.6</b> Basic Commands</a></li>
<li class="chapter" data-level="2.7" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html#built-in-functions"><i class="fa fa-check"></i><b>2.7</b> Built-in Functions</a></li>
<li class="chapter" data-level="2.8" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html#librariespackages"><i class="fa fa-check"></i><b>2.8</b> Libraries/Packages</a></li>
<li class="chapter" data-level="2.9" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html#values-and-their-types"><i class="fa fa-check"></i><b>2.9</b> Values and their types</a></li>
<li class="chapter" data-level="2.10" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html#basic-data-structures-and-their-practical-usage"><i class="fa fa-check"></i><b>2.10</b> Basic Data Structures and Their Practical Usage</a>
<ul>
<li class="chapter" data-level="2.10.1" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html#basic-data-structures"><i class="fa fa-check"></i><b>2.10.1</b> Basic data structures</a></li>
<li class="chapter" data-level="2.10.2" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html#main-properties-of-basic-data-structures"><i class="fa fa-check"></i><b>2.10.2</b> Main properties of basic data structures</a></li>
<li class="chapter" data-level="2.10.3" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html#most-common-usage-of-basic-data-structures"><i class="fa fa-check"></i><b>2.10.3</b> Most Common Usage of Basic Data Structures:</a></li>
<li class="chapter" data-level="2.10.4" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html#basic-data-structures-examples"><i class="fa fa-check"></i><b>2.10.4</b> Basic Data Structures Examples</a></li>
</ul></li>
<li class="chapter" data-level="2.11" data-path="rstudio-basic-r-commands-swirl-tutorials.html"><a href="rstudio-basic-r-commands-swirl-tutorials.html#homework-with-swirl"><i class="fa fa-check"></i><b>2.11</b> Homework with <code>swirl()</code></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="r-markdown-and-r-notebooks.html"><a href="r-markdown-and-r-notebooks.html"><i class="fa fa-check"></i><b>3</b> R Markdown and R Notebooks</a>
<ul>
<li class="chapter" data-level="3.1" data-path="r-markdown-and-r-notebooks.html"><a href="r-markdown-and-r-notebooks.html#previous-lesson"><i class="fa fa-check"></i><b>3.1</b> Previous lesson</a></li>
<li class="chapter" data-level="3.2" data-path="r-markdown-and-r-notebooks.html"><a href="r-markdown-and-r-notebooks.html#this-lesson"><i class="fa fa-check"></i><b>3.2</b> This lesson</a></li>
<li class="chapter" data-level="3.3" data-path="r-markdown-and-r-notebooks.html"><a href="r-markdown-and-r-notebooks.html#r-notebookmarkdown"><i class="fa fa-check"></i><b>3.3</b> R Notebook/Markdown</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="r-markdown-and-r-notebooks.html"><a href="r-markdown-and-r-notebooks.html#r-notebook-yml-header"><i class="fa fa-check"></i><b>3.3.1</b> R Notebook/ YML Header</a></li>
<li class="chapter" data-level="3.3.2" data-path="r-markdown-and-r-notebooks.html"><a href="r-markdown-and-r-notebooks.html#basics-of-markdown"><i class="fa fa-check"></i><b>3.3.2</b> Basics of Markdown</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="r-markdown-and-r-notebooks.html"><a href="r-markdown-and-r-notebooks.html#homework-1"><i class="fa fa-check"></i><b>3.4</b> Homework</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html"><i class="fa fa-check"></i><b>4</b> Data Manipulation I</a>
<ul>
<li class="chapter" data-level="4.1" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#this-chapter-1"><i class="fa fa-check"></i><b>4.1</b> This Chapter</a></li>
<li class="chapter" data-level="4.2" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#why-tidyverse"><i class="fa fa-check"></i><b>4.2</b> Why <code>tidyverse</code>?</a></li>
<li class="chapter" data-level="4.3" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#main-data-file-formats-csv-and-tsv"><i class="fa fa-check"></i><b>4.3</b> Main Data File Formats: CSV and TSV</a></li>
<li class="chapter" data-level="4.4" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#loading-data-into-r"><i class="fa fa-check"></i><b>4.4</b> Loading Data into R</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#loading-csv-and-tsv-files"><i class="fa fa-check"></i><b>4.4.1</b> Loading CSV and TSV files</a></li>
<li class="chapter" data-level="4.4.2" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#r-specific-data-format-rds"><i class="fa fa-check"></i><b>4.4.2</b> R-specific Data “Format”: RDS</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#loading-pua-data"><i class="fa fa-check"></i><b>4.5</b> Loading PUA data</a></li>
<li class="chapter" data-level="4.6" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#exploring-pua-data"><i class="fa fa-check"></i><b>4.6</b> Exploring PUA Data</a></li>
<li class="chapter" data-level="4.7" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#main-commands-for-engaging-with-a-tibble"><i class="fa fa-check"></i><b>4.7</b> Main commands for engaging with a tibble</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#chaining-with"><i class="fa fa-check"></i><b>4.7.1</b> Chaining with <code>%&gt;%</code></a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#important-functions-from-dplyr"><i class="fa fa-check"></i><b>4.8</b> Important Functions from <code>dplyr</code></a></li>
<li class="chapter" data-level="4.9" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#important-functions-from-tidyr"><i class="fa fa-check"></i><b>4.9</b> Important Functions from <code>tidyr</code></a></li>
<li class="chapter" data-level="4.10" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#function-usage"><i class="fa fa-check"></i><b>4.10</b> Function usage</a>
<ul>
<li class="chapter" data-level="4.10.1" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#filter"><i class="fa fa-check"></i><b>4.10.1</b> <code>filter()</code></a></li>
<li class="chapter" data-level="4.10.2" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#select"><i class="fa fa-check"></i><b>4.10.2</b> <code>select()</code></a></li>
<li class="chapter" data-level="4.10.3" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#mutate-and-transmute"><i class="fa fa-check"></i><b>4.10.3</b> <code>mutate()</code> and <code>transmute()</code></a></li>
<li class="chapter" data-level="4.10.4" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#rename"><i class="fa fa-check"></i><b>4.10.4</b> <code>rename()</code></a></li>
<li class="chapter" data-level="4.10.5" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#arrange"><i class="fa fa-check"></i><b>4.10.5</b> <code>arrange()</code></a></li>
<li class="chapter" data-level="4.10.6" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#group_by-ungroup"><i class="fa fa-check"></i><b>4.10.6</b> <code>group_by()</code> / <code>ungroup()</code></a></li>
<li class="chapter" data-level="4.10.7" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#summarise-or-summarize"><i class="fa fa-check"></i><b>4.10.7</b> <code>summarise()</code> or <code>summarize()</code></a></li>
<li class="chapter" data-level="4.10.8" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#join_-functions"><i class="fa fa-check"></i><b>4.10.8</b> <code>join_*</code> functions</a></li>
<li class="chapter" data-level="4.10.9" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#pivot_-functions"><i class="fa fa-check"></i><b>4.10.9</b> <code>pivot_*()</code> functions</a></li>
</ul></li>
<li class="chapter" data-level="4.11" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#homework-tasks"><i class="fa fa-check"></i><b>4.11</b> Homework Tasks</a></li>
<li class="chapter" data-level="4.12" data-path="data-manipulation-i.html"><a href="data-manipulation-i.html#appendix-window-function-in-tidyverse"><i class="fa fa-check"></i><b>4.12</b> Appendix: “Window” function in <code>tidyverse</code></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-manipulation-ii.html"><a href="data-manipulation-ii.html"><i class="fa fa-check"></i><b>5</b> Data Manipulation II</a>
<ul>
<li class="chapter" data-level="5.1" data-path="data-manipulation-ii.html"><a href="data-manipulation-ii.html#this-chapter-2"><i class="fa fa-check"></i><b>5.1</b> This Chapter</a></li>
<li class="chapter" data-level="5.2" data-path="data-manipulation-ii.html"><a href="data-manipulation-ii.html#problems"><i class="fa fa-check"></i><b>5.2</b> Problems</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="control-flow-regular-expressions.html"><a href="control-flow-regular-expressions.html"><i class="fa fa-check"></i><b>6</b> Control Flow; Regular Expressions</a>
<ul>
<li class="chapter" data-level="6.1" data-path="control-flow-regular-expressions.html"><a href="control-flow-regular-expressions.html#this-chapter-3"><i class="fa fa-check"></i><b>6.1</b> This Chapter</a></li>
<li class="chapter" data-level="6.2" data-path="control-flow-regular-expressions.html"><a href="control-flow-regular-expressions.html#control-flow"><i class="fa fa-check"></i><b>6.2</b> Control Flow</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="control-flow-regular-expressions.html"><a href="control-flow-regular-expressions.html#conditional-statements"><i class="fa fa-check"></i><b>6.2.1</b> Conditional statements</a></li>
<li class="chapter" data-level="6.2.2" data-path="control-flow-regular-expressions.html"><a href="control-flow-regular-expressions.html#loops"><i class="fa fa-check"></i><b>6.2.2</b> Loops</a></li>
<li class="chapter" data-level="6.2.3" data-path="control-flow-regular-expressions.html"><a href="control-flow-regular-expressions.html#functions"><i class="fa fa-check"></i><b>6.2.3</b> Functions</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="control-flow-regular-expressions.html"><a href="control-flow-regular-expressions.html#regular-expressions-in-r"><i class="fa fa-check"></i><b>6.3</b> Regular Expressions in R</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="control-flow-regular-expressions.html"><a href="control-flow-regular-expressions.html#basics-of-regular-expressions"><i class="fa fa-check"></i><b>6.3.1</b> Basics of Regular Expressions</a></li>
<li class="chapter" data-level="6.3.2" data-path="control-flow-regular-expressions.html"><a href="control-flow-regular-expressions.html#regular-expressions-in-r-1"><i class="fa fa-check"></i><b>6.3.2</b> Regular Expressions in R</a></li>
<li class="chapter" data-level="6.3.3" data-path="control-flow-regular-expressions.html"><a href="control-flow-regular-expressions.html#tips-for-regular-expressions-in-r"><i class="fa fa-check"></i><b>6.3.3</b> Tips for Regular Expressions in R</a></li>
<li class="chapter" data-level="6.3.4" data-path="control-flow-regular-expressions.html"><a href="control-flow-regular-expressions.html#in-class-practice"><i class="fa fa-check"></i><b>6.3.4</b> In-Class Practice</a></li>
<li class="chapter" data-level="6.3.5" data-path="control-flow-regular-expressions.html"><a href="control-flow-regular-expressions.html#the-practice-regex-file"><i class="fa fa-check"></i><b>6.3.5</b> The Practice Regex File</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html"><i class="fa fa-check"></i><b>7</b> Getting Your Data Right</a>
<ul>
<li class="chapter" data-level="7.1" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html#this-chapter-4"><i class="fa fa-check"></i><b>7.1</b> This Chapter</a></li>
<li class="chapter" data-level="7.2" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html#getting-your-own-data"><i class="fa fa-check"></i><b>7.2</b> 1. Getting your own data</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html#ways-of-obtaining-data"><i class="fa fa-check"></i><b>7.2.1</b> Ways of obtaining data</a></li>
<li class="chapter" data-level="7.2.2" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html#major-formats"><i class="fa fa-check"></i><b>7.2.2</b> Major formats</a></li>
<li class="chapter" data-level="7.2.3" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html#ways-of-obtaining-data-1"><i class="fa fa-check"></i><b>7.2.3</b> Ways of obtaining data</a></li>
<li class="chapter" data-level="7.2.4" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html#major-formats-1"><i class="fa fa-check"></i><b>7.2.4</b> Major formats</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html#tidying-data"><i class="fa fa-check"></i><b>7.3</b> 2. Tidying Data</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html#basic-principles-of-organizing-data-tidy-data"><i class="fa fa-check"></i><b>7.3.1</b> Basic principles of organizing data: <em>Tidy Data</em></a></li>
<li class="chapter" data-level="7.3.2" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html#clean-data-tidy-data-additional-explanations"><i class="fa fa-check"></i><b>7.3.2</b> Clean Data / Tidy Data: <em>additional explanations</em></a></li>
<li class="chapter" data-level="7.3.3" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html#discussion-a-bulliet-dataset"><i class="fa fa-check"></i><b>7.3.3</b> <em>Discussion</em>: “A Bulliet Dataset”</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html#modeling-data"><i class="fa fa-check"></i><b>7.4</b> 3. Modeling Data</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html#categorization-as-a-way-of-modeling-data"><i class="fa fa-check"></i><b>7.4.1</b> Categorization as a Way of modeling data</a></li>
<li class="chapter" data-level="7.4.2" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html#normalization"><i class="fa fa-check"></i><b>7.4.2</b> Normalization</a></li>
<li class="chapter" data-level="7.4.3" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html#note-proxies-features-abstractions"><i class="fa fa-check"></i><b>7.4.3</b> Note: <em>Proxies</em>, <em>Features</em>, <em>Abstractions</em></a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="getting-your-data-right.html"><a href="getting-your-data-right.html#appendix-ocr-with-r"><i class="fa fa-check"></i><b>7.5</b> Appendix: OCR with R</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="deep-look-into-the-pua-dataset.html"><a href="deep-look-into-the-pua-dataset.html"><i class="fa fa-check"></i><b>8</b> Deep Look into the PUA Dataset</a>
<ul>
<li class="chapter" data-level="8.1" data-path="deep-look-into-the-pua-dataset.html"><a href="deep-look-into-the-pua-dataset.html#updated-pua-dataset"><i class="fa fa-check"></i><b>8.1</b> Updated PUA Dataset</a></li>
<li class="chapter" data-level="8.2" data-path="deep-look-into-the-pua-dataset.html"><a href="deep-look-into-the-pua-dataset.html#normalized-and-improved-pua-dataset"><i class="fa fa-check"></i><b>8.2</b> Normalized and Improved PUA Dataset</a></li>
<li class="chapter" data-level="8.3" data-path="deep-look-into-the-pua-dataset.html"><a href="deep-look-into-the-pua-dataset.html#modeling-pua-dataset"><i class="fa fa-check"></i><b>8.3</b> Modeling PUA Dataset</a></li>
<li class="chapter" data-level="8.4" data-path="deep-look-into-the-pua-dataset.html"><a href="deep-look-into-the-pua-dataset.html#conceptual-models-for-your-data"><i class="fa fa-check"></i><b>8.4</b> Conceptual Models for Your Data</a></li>
<li class="chapter" data-level="8.5" data-path="deep-look-into-the-pua-dataset.html"><a href="deep-look-into-the-pua-dataset.html#implementation"><i class="fa fa-check"></i><b>8.5</b> Implementation</a></li>
<li class="chapter" data-level="8.6" data-path="deep-look-into-the-pua-dataset.html"><a href="deep-look-into-the-pua-dataset.html#homework-assignment"><i class="fa fa-check"></i><b>8.6</b> Homework assignment</a></li>
<li class="chapter" data-level="8.7" data-path="deep-look-into-the-pua-dataset.html"><a href="deep-look-into-the-pua-dataset.html#reference-materials"><i class="fa fa-check"></i><b>8.7</b> Reference Materials</a></li>
<li class="chapter" data-level="8.8" data-path="deep-look-into-the-pua-dataset.html"><a href="deep-look-into-the-pua-dataset.html#appendix-1-pua-data-tables"><i class="fa fa-check"></i><b>8.8</b> Appendix 1: PUA Data Tables</a>
<ul>
<li class="chapter" data-level="8.8.1" data-path="deep-look-into-the-pua-dataset.html"><a href="deep-look-into-the-pua-dataset.html#main-table"><i class="fa fa-check"></i><b>8.8.1</b> Main Table</a></li>
<li class="chapter" data-level="8.8.2" data-path="deep-look-into-the-pua-dataset.html"><a href="deep-look-into-the-pua-dataset.html#connection-tables"><i class="fa fa-check"></i><b>8.8.2</b> Connection Tables</a></li>
<li class="chapter" data-level="8.8.3" data-path="deep-look-into-the-pua-dataset.html"><a href="deep-look-into-the-pua-dataset.html#auxiliary-tables"><i class="fa fa-check"></i><b>8.8.3</b> Auxiliary Tables</a></li>
<li class="chapter" data-level="8.8.4" data-path="deep-look-into-the-pua-dataset.html"><a href="deep-look-into-the-pua-dataset.html#metadata-tables"><i class="fa fa-check"></i><b>8.8.4</b> Metadata Tables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html"><i class="fa fa-check"></i><b>9</b> Visualizations: <code>plot()</code> and <code>ggplot()</code></a>
<ul>
<li class="chapter" data-level="9.1" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#this-chapter-5"><i class="fa fa-check"></i><b>9.1</b> This Chapter</a></li>
<li class="chapter" data-level="9.2" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#conceptual-issues"><i class="fa fa-check"></i><b>9.2</b> Conceptual Issues</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#perception"><i class="fa fa-check"></i><b>9.2.1</b> Perception</a></li>
<li class="chapter" data-level="9.2.2" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#the-rules-of-thumb-for-visualizations"><i class="fa fa-check"></i><b>9.2.2</b> The Rules of Thumb for Visualizations</a></li>
<li class="chapter" data-level="9.2.3" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#types-of-graphs-and-when-to-use-them"><i class="fa fa-check"></i><b>9.2.3</b> Types of Graphs and When to Use Them</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#r-built-in-graphics-functions-quick-overview"><i class="fa fa-check"></i><b>9.3</b> R Built-in Graphics Functions: Quick Overview</a></li>
<li class="chapter" data-level="9.4" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#tidyverse-graphs-ggplot2"><i class="fa fa-check"></i><b>9.4</b> <code>Tidyverse</code> Graphs: <code>ggplot2</code></a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#grammar-of-graphics"><i class="fa fa-check"></i><b>9.4.1</b> Grammar of Graphics</a></li>
<li class="chapter" data-level="9.4.2" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#code-breakdown"><i class="fa fa-check"></i><b>9.4.2</b> Code Breakdown</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#simpler-graphs"><i class="fa fa-check"></i><b>9.5</b> Simpler graphs</a></li>
<li class="chapter" data-level="9.6" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#other-types-of-graphs"><i class="fa fa-check"></i><b>9.6</b> Other types of graphs</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#scatter-plots"><i class="fa fa-check"></i><b>9.6.1</b> 1. Scatter plots</a></li>
<li class="chapter" data-level="9.6.2" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#line-charts"><i class="fa fa-check"></i><b>9.6.2</b> 2. Line charts</a></li>
<li class="chapter" data-level="9.6.3" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#bar-charts"><i class="fa fa-check"></i><b>9.6.3</b> 3. Bar charts</a></li>
<li class="chapter" data-level="9.6.4" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#histograms"><i class="fa fa-check"></i><b>9.6.4</b> 4. Histograms</a></li>
<li class="chapter" data-level="9.6.5" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#wordclouds"><i class="fa fa-check"></i><b>9.6.5</b> 5. Wordclouds</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#homework-assignment-1"><i class="fa fa-check"></i><b>9.7</b> Homework assignment</a></li>
<li class="chapter" data-level="9.8" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#appendices"><i class="fa fa-check"></i><b>9.8</b> Appendices</a>
<ul>
<li class="chapter" data-level="9.8.1" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#appendix-1-when-a-simple-table-may-suffice"><i class="fa fa-check"></i><b>9.8.1</b> Appendix 1: When a “Simple” Table May Suffice</a></li>
</ul></li>
<li class="chapter" data-level="9.9" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#appendix-interactive-graphs"><i class="fa fa-check"></i><b>9.9</b> Appendix: Interactive Graphs</a>
<ul>
<li class="chapter" data-level="9.9.1" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#appendix-checklist-for-creating-visualizations"><i class="fa fa-check"></i><b>9.9.1</b> Appendix: Checklist for Creating Visualizations</a></li>
</ul></li>
<li class="chapter" data-level="9.10" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#appendix-scientific-notation"><i class="fa fa-check"></i><b>9.10</b> Appendix: Scientific Notation</a></li>
<li class="chapter" data-level="9.11" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#homework-solutions-partial"><i class="fa fa-check"></i><b>9.11</b> Homework solutions (partial)</a>
<ul>
<li class="chapter" data-level="9.11.1" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#line-charts-1"><i class="fa fa-check"></i><b>9.11.1</b> Line charts</a></li>
<li class="chapter" data-level="9.11.2" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#bar-charts-1"><i class="fa fa-check"></i><b>9.11.2</b> 3. Bar charts</a></li>
<li class="chapter" data-level="9.11.3" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#histograms-1"><i class="fa fa-check"></i><b>9.11.3</b> 4. Histograms</a></li>
<li class="chapter" data-level="9.11.4" data-path="visualizations-plot-and-ggplot.html"><a href="visualizations-plot-and-ggplot.html#wordclouds---homework"><i class="fa fa-check"></i><b>9.11.4</b> 5. Wordclouds - Homework</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="overview-of-the-pua-dataset.html"><a href="overview-of-the-pua-dataset.html"><i class="fa fa-check"></i><b>10</b> Overview of the PUA dataset</a>
<ul>
<li class="chapter" data-level="10.1" data-path="overview-of-the-pua-dataset.html"><a href="overview-of-the-pua-dataset.html#the-initial-sql-database-extraction-of-tables"><i class="fa fa-check"></i><b>10.1</b> The initial SQL Database: extraction of tables</a></li>
<li class="chapter" data-level="10.2" data-path="overview-of-the-pua-dataset.html"><a href="overview-of-the-pua-dataset.html#extracting-tables-with-r"><i class="fa fa-check"></i><b>10.2</b> Extracting tables with R</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="overview-of-the-pua-dataset.html"><a href="overview-of-the-pua-dataset.html#looking-at-the-data"><i class="fa fa-check"></i><b>10.2.1</b> Looking at the data</a></li>
<li class="chapter" data-level="10.2.2" data-path="overview-of-the-pua-dataset.html"><a href="overview-of-the-pua-dataset.html#reorganization-conceptual-model-for-your-data"><i class="fa fa-check"></i><b>10.2.2</b> Reorganization: Conceptual Model For Your Data</a></li>
<li class="chapter" data-level="10.2.3" data-path="overview-of-the-pua-dataset.html"><a href="overview-of-the-pua-dataset.html#improving-pua-data"><i class="fa fa-check"></i><b>10.2.3</b> Improving PUA Data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="geographical-maps-cartograms.html"><a href="geographical-maps-cartograms.html"><i class="fa fa-check"></i><b>11</b> Geographical Maps &amp; Cartograms</a>
<ul>
<li class="chapter" data-level="11.1" data-path="geographical-maps-cartograms.html"><a href="geographical-maps-cartograms.html#creating-base-maps"><i class="fa fa-check"></i><b>11.1</b> Creating Base Maps</a></li>
<li class="chapter" data-level="11.2" data-path="geographical-maps-cartograms.html"><a href="geographical-maps-cartograms.html#core-concepts-and-their-practical-implementations"><i class="fa fa-check"></i><b>11.2</b> Core concepts and their practical implementations</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="geographical-maps-cartograms.html"><a href="geographical-maps-cartograms.html#projection-issues"><i class="fa fa-check"></i><b>11.2.1</b> Projection Issues</a></li>
<li class="chapter" data-level="11.2.2" data-path="geographical-maps-cartograms.html"><a href="geographical-maps-cartograms.html#a-digital-map-layers-of-goodness"><i class="fa fa-check"></i><b>11.2.2</b> A Digital Map: Layers of Goodness</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="geographical-maps-cartograms.html"><a href="geographical-maps-cartograms.html#main-types-of-data-points-lines-polygons"><i class="fa fa-check"></i><b>11.3</b> Main Types of Data: Points, Lines, Polygons</a></li>
<li class="chapter" data-level="11.4" data-path="geographical-maps-cartograms.html"><a href="geographical-maps-cartograms.html#base-maps"><i class="fa fa-check"></i><b>11.4</b> Base maps</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="geographical-maps-cartograms.html"><a href="geographical-maps-cartograms.html#new-libraries"><i class="fa fa-check"></i><b>11.4.1</b> New libraries</a></li>
<li class="chapter" data-level="11.4.2" data-path="geographical-maps-cartograms.html"><a href="geographical-maps-cartograms.html#compiling-the-base-map"><i class="fa fa-check"></i><b>11.4.2</b> Compiling the base map</a></li>
<li class="chapter" data-level="11.4.3" data-path="geographical-maps-cartograms.html"><a href="geographical-maps-cartograms.html#adding-data"><i class="fa fa-check"></i><b>11.4.3</b> Adding data</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="geographical-maps-cartograms.html"><a href="geographical-maps-cartograms.html#raster-base-maps"><i class="fa fa-check"></i><b>11.5</b> Raster base maps</a></li>
<li class="chapter" data-level="11.6" data-path="geographical-maps-cartograms.html"><a href="geographical-maps-cartograms.html#homework-2"><i class="fa fa-check"></i><b>11.6</b> Homework</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="modeling-complex-entities.html"><a href="modeling-complex-entities.html"><i class="fa fa-check"></i><b>12</b> Modeling Complex Entities</a>
<ul>
<li class="chapter" data-level="12.1" data-path="modeling-complex-entities.html"><a href="modeling-complex-entities.html#modeling-regions"><i class="fa fa-check"></i><b>12.1</b> Modeling Regions</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="modeling-complex-entities.html"><a href="modeling-complex-entities.html#base-map-for-al-andalus"><i class="fa fa-check"></i><b>12.1.1</b> Base map for al-Andalus</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="modeling-complex-entities.html"><a href="modeling-complex-entities.html#modeling-periods"><i class="fa fa-check"></i><b>12.2</b> Modeling Periods</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="modeling-complex-entities.html"><a href="modeling-complex-entities.html#a-1000-and-1-tries"><i class="fa fa-check"></i><b>12.2.1</b> A 1000 And 1 Tries</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="class-12.html"><a href="class-12.html"><i class="fa fa-check"></i><b>13</b> Class 12</a></li>
<li class="chapter" data-level="14" data-path="class-13.html"><a href="class-13.html"><i class="fa fa-check"></i><b>14</b> Class 13</a></li>
<li class="chapter" data-level="15" data-path="class-14.html"><a href="class-14.html"><i class="fa fa-check"></i><b>15</b> Class 14</a></li>
<li class="chapter" data-level="16" data-path="glossary-of-computer-terms.html"><a href="glossary-of-computer-terms.html"><i class="fa fa-check"></i><b>16</b> Glossary of Computer Terms</a>
<ul>
<li class="chapter" data-level="16.1" data-path="glossary-of-computer-terms.html"><a href="glossary-of-computer-terms.html#general-computer-terms"><i class="fa fa-check"></i><b>16.1</b> General Computer Terms</a></li>
<li class="chapter" data-level="16.2" data-path="glossary-of-computer-terms.html"><a href="glossary-of-computer-terms.html#r-specific-terms"><i class="fa fa-check"></i><b>16.2</b> R-Specific Terms</a></li>
<li class="chapter" data-level="16.3" data-path="glossary-of-computer-terms.html"><a href="glossary-of-computer-terms.html#nlp-and-linguistics"><i class="fa fa-check"></i><b>16.3</b> NLP and Linguistics</a></li>
<li class="chapter" data-level="16.4" data-path="glossary-of-computer-terms.html"><a href="glossary-of-computer-terms.html#machine-learning"><i class="fa fa-check"></i><b>16.4</b> Machine Learning</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="appendices-1.html"><a href="appendices-1.html"><i class="fa fa-check"></i><b>17</b> Appendices</a>
<ul>
<li class="chapter" data-level="17.1" data-path="appendices-1.html"><a href="appendices-1.html#appendix-i-importance-of-basic-computer-skills-for-humanists"><i class="fa fa-check"></i><b>17.1</b> Appendix I: Importance of basic computer skills for humanists</a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="appendices-1.html"><a href="appendices-1.html#importance-of-basic-computer-skills-for-humanists"><i class="fa fa-check"></i><b>17.1.1</b> Importance of basic computer skills for humanists</a></li>
<li class="chapter" data-level="17.1.2" data-path="appendices-1.html"><a href="appendices-1.html#access-to-information"><i class="fa fa-check"></i><b>17.1.2</b> Access to information</a></li>
<li class="chapter" data-level="17.1.3" data-path="appendices-1.html"><a href="appendices-1.html#organization-and-management-of-research-material"><i class="fa fa-check"></i><b>17.1.3</b> Organization and management of research material</a></li>
<li class="chapter" data-level="17.1.4" data-path="appendices-1.html"><a href="appendices-1.html#file-organization"><i class="fa fa-check"></i><b>17.1.4</b> File Organization</a></li>
<li class="chapter" data-level="17.1.5" data-path="appendices-1.html"><a href="appendices-1.html#finding-your-way-around-the-computer"><i class="fa fa-check"></i><b>17.1.5</b> Finding your way around the computer</a></li>
<li class="chapter" data-level="17.1.6" data-path="appendices-1.html"><a href="appendices-1.html#common-file-formats-and-extensions"><i class="fa fa-check"></i><b>17.1.6</b> Common file formats and extensions</a></li>
<li class="chapter" data-level="17.1.7" data-path="appendices-1.html"><a href="appendices-1.html#organizing-files-and-folders-for-research-projects"><i class="fa fa-check"></i><b>17.1.7</b> Organizing files and folders for research projects</a></li>
<li class="chapter" data-level="17.1.8" data-path="appendices-1.html"><a href="appendices-1.html#demonstration-of-file-navigation-using-a-file-explorer-windows-or-finder-mac"><i class="fa fa-check"></i><b>17.1.8</b> Demonstration of file navigation using a file explorer (Windows) or Finder (Mac)</a></li>
<li class="chapter" data-level="17.1.9" data-path="appendices-1.html"><a href="appendices-1.html#command-line-basics"><i class="fa fa-check"></i><b>17.1.9</b> Command Line Basics</a></li>
<li class="chapter" data-level="17.1.10" data-path="appendices-1.html"><a href="appendices-1.html#introduction-to-command-line-interfaces"><i class="fa fa-check"></i><b>17.1.10</b> Introduction to command line interfaces</a></li>
<li class="chapter" data-level="17.1.11" data-path="appendices-1.html"><a href="appendices-1.html#command-line-basic-commands"><i class="fa fa-check"></i><b>17.1.11</b> Command Line: Basic Commands</a></li>
<li class="chapter" data-level="17.1.12" data-path="appendices-1.html"><a href="appendices-1.html#creating-moving-renaming-and-deleting-files-and-folders"><i class="fa fa-check"></i><b>17.1.12</b> Creating, moving, renaming, and deleting files and folders</a></li>
<li class="chapter" data-level="17.1.13" data-path="appendices-1.html"><a href="appendices-1.html#tips-for-efficient-command-line-usage"><i class="fa fa-check"></i><b>17.1.13</b> Tips for efficient command line usage</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="bibliography.html"><a href="bibliography.html"><i class="fa fa-check"></i><b>18</b> Bibliography</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">HDIS: Analysis of Prosopographical Data–with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="modeling-complex-entities" class="section level1 hasAnchor" number="12">
<h1><span class="header-section-number">12</span> Modeling Complex Entities<a href="modeling-complex-entities.html#modeling-complex-entities" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="modeling-regions" class="section level2 hasAnchor" number="12.1">
<h2><span class="header-section-number">12.1</span> Modeling Regions<a href="modeling-complex-entities.html#modeling-regions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s begin with loading necessary libraries and the PUA data.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="modeling-complex-entities.html#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb156-2"><a href="modeling-complex-entities.html#cb156-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-3"><a href="modeling-complex-entities.html#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb156-4"><a href="modeling-complex-entities.html#cb156-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb156-5"><a href="modeling-complex-entities.html#cb156-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearthdata)</span>
<span id="cb156-6"><a href="modeling-complex-entities.html#cb156-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-7"><a href="modeling-complex-entities.html#cb156-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggmap)</span>
<span id="cb156-8"><a href="modeling-complex-entities.html#cb156-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggspatial)</span>
<span id="cb156-9"><a href="modeling-complex-entities.html#cb156-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb156-10"><a href="modeling-complex-entities.html#cb156-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-11"><a href="modeling-complex-entities.html#cb156-11" aria-hidden="true" tabindex="-1"></a>PUA <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;./data/PUA_processed/PUA_allDataTables_asList.rds&quot;</span>)</span></code></pre></div>
<div id="base-map-for-al-andalus" class="section level3 hasAnchor" number="12.1.1">
<h3><span class="header-section-number">12.1.1</span> Base map for al-Andalus<a href="modeling-complex-entities.html#base-map-for-al-andalus" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s create a basemap for al-Andalus, which we can then quicly re-load whenever we need it:</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="modeling-complex-entities.html#cb157-1" aria-hidden="true" tabindex="-1"></a>world <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="st">&quot;medium&quot;</span>, <span class="at">returnclass =</span> <span class="st">&quot;sf&quot;</span>)</span>
<span id="cb157-2"><a href="modeling-complex-entities.html#cb157-2" aria-hidden="true" tabindex="-1"></a>rivers_df <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;./data/map_objects/rivers_df.rds&quot;</span>)</span>
<span id="cb157-3"><a href="modeling-complex-entities.html#cb157-3" aria-hidden="true" tabindex="-1"></a>aral_sea_df <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;./data/map_objects/aral_sea_df.rds&quot;</span>)</span>
<span id="cb157-4"><a href="modeling-complex-entities.html#cb157-4" aria-hidden="true" tabindex="-1"></a>routes_df <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;./data/map_objects/routes_df.rds&quot;</span>)</span>
<span id="cb157-5"><a href="modeling-complex-entities.html#cb157-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-6"><a href="modeling-complex-entities.html#cb157-6" aria-hidden="true" tabindex="-1"></a><span class="co"># focus on al-Andalus: we simply need to change xlim and ylim parameters:</span></span>
<span id="cb157-7"><a href="modeling-complex-entities.html#cb157-7" aria-hidden="true" tabindex="-1"></a>xlimAnd<span class="ot">=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">5</span>); ylimAnd<span class="ot">=</span><span class="fu">c</span>(<span class="dv">35</span>,<span class="dv">44</span>)</span>
<span id="cb157-8"><a href="modeling-complex-entities.html#cb157-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-9"><a href="modeling-complex-entities.html#cb157-9" aria-hidden="true" tabindex="-1"></a>base_plot_andalus <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> world) <span class="sc">+</span></span>
<span id="cb157-10"><a href="modeling-complex-entities.html#cb157-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">fill=</span><span class="st">&quot;white&quot;</span>, <span class="at">color=</span><span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb157-11"><a href="modeling-complex-entities.html#cb157-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># routes from Althurayya</span></span>
<span id="cb157-12"><a href="modeling-complex-entities.html#cb157-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> routes_df,<span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group),</span>
<span id="cb157-13"><a href="modeling-complex-entities.html#cb157-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> roadColor, <span class="at">linewidth =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb157-14"><a href="modeling-complex-entities.html#cb157-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rivers and the aral sea</span></span>
<span id="cb157-15"><a href="modeling-complex-entities.html#cb157-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> rivers_df,<span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group),</span>
<span id="cb157-16"><a href="modeling-complex-entities.html#cb157-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> waterColor, <span class="at">linewidth =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb157-17"><a href="modeling-complex-entities.html#cb157-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> aral_sea_df,<span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group),</span>
<span id="cb157-18"><a href="modeling-complex-entities.html#cb157-18" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> waterColor, <span class="at">fill =</span> waterColor, <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb157-19"><a href="modeling-complex-entities.html#cb157-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># annotation scale</span></span>
<span id="cb157-20"><a href="modeling-complex-entities.html#cb157-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">&quot;bl&quot;</span>, <span class="at">width_hint =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb157-21"><a href="modeling-complex-entities.html#cb157-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">&quot;bl&quot;</span>, <span class="at">which_north =</span> <span class="st">&quot;true&quot;</span>,</span>
<span id="cb157-22"><a href="modeling-complex-entities.html#cb157-22" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pad_x =</span> <span class="fu">unit</span>(<span class="fl">0.0</span>, <span class="st">&quot;in&quot;</span>), <span class="at">pad_y =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">&quot;in&quot;</span>),</span>
<span id="cb157-23"><a href="modeling-complex-entities.html#cb157-23" aria-hidden="true" tabindex="-1"></a>                         <span class="at">style =</span> north_arrow_fancy_orienteering) <span class="sc">+</span></span>
<span id="cb157-24"><a href="modeling-complex-entities.html#cb157-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># map limits and theme</span></span>
<span id="cb157-25"><a href="modeling-complex-entities.html#cb157-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> xlimAnd, <span class="at">ylim =</span> ylimAnd, <span class="at">expand =</span> <span class="cn">FALSE</span>)</span>
<span id="cb157-26"><a href="modeling-complex-entities.html#cb157-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-27"><a href="modeling-complex-entities.html#cb157-27" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(base_plot_andalus, <span class="at">file =</span> <span class="st">&quot;./data/basemap/base_plot_andalus.RData&quot;</span>)</span>
<span id="cb157-28"><a href="modeling-complex-entities.html#cb157-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-29"><a href="modeling-complex-entities.html#cb157-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-30"><a href="modeling-complex-entities.html#cb157-30" aria-hidden="true" tabindex="-1"></a><span class="co"># NOW TRY THEMED</span></span>
<span id="cb157-31"><a href="modeling-complex-entities.html#cb157-31" aria-hidden="true" tabindex="-1"></a>waterColor <span class="ot">&lt;-</span> <span class="st">&quot;lightsteelblue2&quot;</span> <span class="co">#</span></span>
<span id="cb157-32"><a href="modeling-complex-entities.html#cb157-32" aria-hidden="true" tabindex="-1"></a>roadColor  <span class="ot">&lt;-</span> <span class="st">&quot;grey90&quot;</span></span>
<span id="cb157-33"><a href="modeling-complex-entities.html#cb157-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-34"><a href="modeling-complex-entities.html#cb157-34" aria-hidden="true" tabindex="-1"></a>themeParameters <span class="ot">&lt;-</span> <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> waterColor),</span>
<span id="cb157-35"><a href="modeling-complex-entities.html#cb157-35" aria-hidden="true" tabindex="-1"></a>                         <span class="at">axis.title.y=</span><span class="fu">element_blank</span>(),</span>
<span id="cb157-36"><a href="modeling-complex-entities.html#cb157-36" aria-hidden="true" tabindex="-1"></a>                         <span class="at">axis.title.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb157-37"><a href="modeling-complex-entities.html#cb157-37" aria-hidden="true" tabindex="-1"></a>                         <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> waterColor,</span>
<span id="cb157-38"><a href="modeling-complex-entities.html#cb157-38" aria-hidden="true" tabindex="-1"></a>                                                         <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>,</span>
<span id="cb157-39"><a href="modeling-complex-entities.html#cb157-39" aria-hidden="true" tabindex="-1"></a>                                                         <span class="at">linewidth =</span> <span class="fl">0.5</span>))</span>
<span id="cb157-40"><a href="modeling-complex-entities.html#cb157-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-41"><a href="modeling-complex-entities.html#cb157-41" aria-hidden="true" tabindex="-1"></a>base_plot_andalus_themed <span class="ot">&lt;-</span> base_plot_andalus <span class="sc">+</span> themeParameters</span>
<span id="cb157-42"><a href="modeling-complex-entities.html#cb157-42" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(base_plot_andalus_themed, <span class="at">file =</span> <span class="st">&quot;./data/basemap/base_plot_andalus_themed.RData&quot;</span>)</span></code></pre></div>
<p>We now can load the prepared basemap and them customize its appearance with a theme, or load a basemaps with a theme already applied. This way we can now focus only on the data that needs to be added to the basemap.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="modeling-complex-entities.html#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;./data/basemap/base_plot_andalus_themed.RData&quot;</span>)</span>
<span id="cb158-2"><a href="modeling-complex-entities.html#cb158-2" aria-hidden="true" tabindex="-1"></a>base_plot_andalus_themed</span></code></pre></div>
<p><img src="handbook_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>We have discussed an option of grouping toponyms into regions by some kind of historical administrative divisions. However, we also ran into a problem of instability of such aggregations, which complicates this task.</p>
<p>Another option — or, perhaps, a complimentary option — is to aggregate smaller toponyms into larger places algorithmically. Namely, we can select a certain number of settlements that would act as magnets (let’s call them gravitons), absorbing smaller places (let’s call them satellites). We can make a selection of gravitons based on their importance: for example, based on how many people we find associated with those places in the PUA data. Then, we can then use some algorithmic solution to associate all minor places with the closest graviton. For example, we can calculate distances* from each sattelite to all the gravitons; then we can associate each satellite with the closest graviton. This appraach will not necessarily create the best representation of sub-regions, but it is fast and quite transparent. After creating this algorithmic divisions we can always tweak associations of individual satellites according to our additional knowledge which we did not factor in into the algorithmic implementation. The advantage of such an approach is also in its flexibility: not only can we can always readjust these divisions, we can also experiment with different variations until we find the most optimal one.</p>
<p>Let’s find our top places first. We can pick them from a map that we generated before. Looking at a map is always a good idea, since we may want to combine two prominent locations that are very close to each other into a single graviton; and we might want to single out a minor location as a graviton in order to preserve a representation of some remote region that does not have locations with high frequencies.</p>
<p><img src="images/generated/PUAR_Cl09_Map01.png" />
Based on the map, I would start with a the following vector (roughly, west to east):</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="modeling-complex-entities.html#cb159-1" aria-hidden="true" tabindex="-1"></a>imanes_vector <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Silves&quot;</span>, <span class="st">&quot;Badajoz&quot;</span>, <span class="st">&quot;Sevilla&quot;</span>, <span class="st">&quot;Algeciras&quot;</span>, <span class="st">&quot;Córdoba&quot;</span>,</span>
<span id="cb159-2"><a href="modeling-complex-entities.html#cb159-2" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;Málaga&quot;</span>, <span class="st">&quot;Toledo&quot;</span>, <span class="st">&quot;Granada&quot;</span>, <span class="st">&quot;Almeria&quot;</span>, <span class="st">&quot;Murcia&quot;</span>,</span>
<span id="cb159-3"><a href="modeling-complex-entities.html#cb159-3" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;Valencia&quot;</span>, <span class="st">&quot;Zaragoza&quot;</span>, <span class="st">&quot;Mallorca (isla)&quot;</span>)</span>
<span id="cb159-4"><a href="modeling-complex-entities.html#cb159-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-5"><a href="modeling-complex-entities.html#cb159-5" aria-hidden="true" tabindex="-1"></a>imanes <span class="ot">&lt;-</span> PUA<span class="sc">$</span>lugar <span class="sc">%&gt;%</span></span>
<span id="cb159-6"><a href="modeling-complex-entities.html#cb159-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(nombre_castellano <span class="sc">%in%</span> imanes_vector) <span class="sc">%&gt;%</span></span>
<span id="cb159-7"><a href="modeling-complex-entities.html#cb159-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">region =</span> nombre_castellano, <span class="at">latR =</span> lat, <span class="at">lngR =</span> lng) <span class="sc">%&gt;%</span></span>
<span id="cb159-8"><a href="modeling-complex-entities.html#cb159-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(region, latR, lngR)</span>
<span id="cb159-9"><a href="modeling-complex-entities.html#cb159-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-10"><a href="modeling-complex-entities.html#cb159-10" aria-hidden="true" tabindex="-1"></a>imanes</span></code></pre></div>
<pre><code>## # A tibble: 12 × 3
##    region           latR   lngR
##    &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;
##  1 Córdoba          37.9 -4.78 
##  2 Zaragoza         41.6 -0.883
##  3 Murcia           38.0 -1.13 
##  4 Sevilla          37.4 -5.98 
##  5 Granada          37.2 -3.60 
##  6 Málaga           36.7 -4.42 
##  7 Mallorca (isla)  39.6  2.65 
##  8 Valencia         39.5 -0.375
##  9 Toledo           39.9 -4.03 
## 10 Algeciras        36.1 -5.45 
## 11 Silves           37.2 -8.43 
## 12 Badajoz          38.9 -6.97</code></pre>
<p>Now we need to aggregate all locations with these magnets. A way to do that is to calculate the distance between all the places and these magnets. (BTW, feel free to change this list!). In the code below we will connect our <code>PUA$lugar</code> with our magnets (<code>imanes</code>) in such a way that each place in our table will get joined with each and every magnet.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="modeling-complex-entities.html#cb161-1" aria-hidden="true" tabindex="-1"></a>lugares_con_imanes <span class="ot">&lt;-</span> PUA<span class="sc">$</span>lugar <span class="sc">%&gt;%</span></span>
<span id="cb161-2"><a href="modeling-complex-entities.html#cb161-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(imanes, <span class="at">by =</span> <span class="cn">NULL</span>) <span class="sc">%&gt;%</span></span>
<span id="cb161-3"><a href="modeling-complex-entities.html#cb161-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># REMOVE ALL PLACES WITH NA</span></span>
<span id="cb161-4"><a href="modeling-complex-entities.html#cb161-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(lat)) <span class="sc">%&gt;%</span></span>
<span id="cb161-5"><a href="modeling-complex-entities.html#cb161-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(FLAG_alandalus <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb161-6"><a href="modeling-complex-entities.html#cb161-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(idLugar) <span class="sc">%&gt;%</span></span>
<span id="cb161-7"><a href="modeling-complex-entities.html#cb161-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>notas, <span class="sc">-</span>descripcion)</span>
<span id="cb161-8"><a href="modeling-complex-entities.html#cb161-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-9"><a href="modeling-complex-entities.html#cb161-9" aria-hidden="true" tabindex="-1"></a>lugares_con_imanes <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(lugares_con_imanes)</span>
<span id="cb161-10"><a href="modeling-complex-entities.html#cb161-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-11"><a href="modeling-complex-entities.html#cb161-11" aria-hidden="true" tabindex="-1"></a>lugares_con_imanes</span></code></pre></div>
<pre><code>## # A tibble: 4,764 × 9
##    idLugar FLAG_alandalus nombre nombre_castellano   lat   lng region       latR
##      &lt;dbl&gt;          &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;
##  1       4              1 قرطبة  Córdoba            37.9 -4.78 Córdoba      37.9
##  2       4              1 قرطبة  Córdoba            37.9 -4.78 Zaragoza     41.6
##  3       4              1 قرطبة  Córdoba            37.9 -4.78 Murcia       38.0
##  4       4              1 قرطبة  Córdoba            37.9 -4.78 Sevilla      37.4
##  5       4              1 قرطبة  Córdoba            37.9 -4.78 Granada      37.2
##  6       4              1 قرطبة  Córdoba            37.9 -4.78 Málaga       36.7
##  7       4              1 قرطبة  Córdoba            37.9 -4.78 Mallorca (…  39.6
##  8       4              1 قرطبة  Córdoba            37.9 -4.78 Valencia     39.5
##  9       4              1 قرطبة  Córdoba            37.9 -4.78 Toledo       39.9
## 10       4              1 قرطبة  Córdoba            37.9 -4.78 Algeciras    36.1
## # ℹ 4,754 more rows
## # ℹ 1 more variable: lngR &lt;dbl&gt;</code></pre>
<p>Now, we need a way to calculate distances between the places. The issue here is that we need to use a special complex formula that would allow us to calculate the length of so-called “great circles” (or arcs), which is the shortest distance over the earth’s surface, giving “as-the-crow-flies” distance between each pair of points. For that we need to use the <a href="https://en.wikipedia.org/wiki/Haversine_formula">Haversine formula</a>. We can write a function that would do the calculations and then apply it to the table.
This is where ChatGPT can be very helpful, since you can ask it to implement the formula in R:</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="modeling-complex-entities.html#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Haversine function to calculate distance between two coordinates</span></span>
<span id="cb163-2"><a href="modeling-complex-entities.html#cb163-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-3"><a href="modeling-complex-entities.html#cb163-3" aria-hidden="true" tabindex="-1"></a>haversine <span class="ot">&lt;-</span> <span class="cf">function</span>(long1, lat1, long2, lat2) {</span>
<span id="cb163-4"><a href="modeling-complex-entities.html#cb163-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert degrees to radians</span></span>
<span id="cb163-5"><a href="modeling-complex-entities.html#cb163-5" aria-hidden="true" tabindex="-1"></a>  long1 <span class="ot">&lt;-</span> long1 <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span></span>
<span id="cb163-6"><a href="modeling-complex-entities.html#cb163-6" aria-hidden="true" tabindex="-1"></a>  lat1 <span class="ot">&lt;-</span> lat1 <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span></span>
<span id="cb163-7"><a href="modeling-complex-entities.html#cb163-7" aria-hidden="true" tabindex="-1"></a>  long2 <span class="ot">&lt;-</span> long2 <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span></span>
<span id="cb163-8"><a href="modeling-complex-entities.html#cb163-8" aria-hidden="true" tabindex="-1"></a>  lat2 <span class="ot">&lt;-</span> lat2 <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span></span>
<span id="cb163-9"><a href="modeling-complex-entities.html#cb163-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-10"><a href="modeling-complex-entities.html#cb163-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Haversine formula</span></span>
<span id="cb163-11"><a href="modeling-complex-entities.html#cb163-11" aria-hidden="true" tabindex="-1"></a>  dlon <span class="ot">&lt;-</span> long2 <span class="sc">-</span> long1</span>
<span id="cb163-12"><a href="modeling-complex-entities.html#cb163-12" aria-hidden="true" tabindex="-1"></a>  dlat <span class="ot">&lt;-</span> lat2 <span class="sc">-</span> lat1</span>
<span id="cb163-13"><a href="modeling-complex-entities.html#cb163-13" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> <span class="fu">sin</span>(dlat <span class="sc">/</span> <span class="dv">2</span>)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">cos</span>(lat1) <span class="sc">*</span> <span class="fu">cos</span>(lat2) <span class="sc">*</span> <span class="fu">sin</span>(dlon <span class="sc">/</span> <span class="dv">2</span>)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb163-14"><a href="modeling-complex-entities.html#cb163-14" aria-hidden="true" tabindex="-1"></a>  c <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">atan2</span>(<span class="fu">sqrt</span>(a), <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">-</span> a))</span>
<span id="cb163-15"><a href="modeling-complex-entities.html#cb163-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-16"><a href="modeling-complex-entities.html#cb163-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Radius of the earth in kilometers</span></span>
<span id="cb163-17"><a href="modeling-complex-entities.html#cb163-17" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> <span class="fl">6371.0</span></span>
<span id="cb163-18"><a href="modeling-complex-entities.html#cb163-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-19"><a href="modeling-complex-entities.html#cb163-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Distance in kilometers</span></span>
<span id="cb163-20"><a href="modeling-complex-entities.html#cb163-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(r <span class="sc">*</span> c)</span>
<span id="cb163-21"><a href="modeling-complex-entities.html#cb163-21" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Note:</strong> since ChatGPT is a generative model, it will always try to give you an answer, but it does not mean that the answer will be correct. One should always keep this in mind and cross-examine ChatGPT results. In this specific case we can simply goggle distances between specific places and check how close those results are to what we have calculated with ChatGPT-provided function. One other thing to keep in mind: ChatGPT often tries to use some libraries as shortcuts to solving specific problems, but this approach tends to fail quite often with R. For example, ChatGPT initially suggested code that uses some obscure R library—and it did not work. Instead I asked to implement the Harvestine formula from scratch and package it into a function that I can reuse.</p>
<p>Now, let’s calculate these distances in our data and pick the closest graviton (i.e., a prominent location for which we have the shortest distance):</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="modeling-complex-entities.html#cb164-1" aria-hidden="true" tabindex="-1"></a>lugares_con_imanes_ultimas <span class="ot">&lt;-</span> lugares_con_imanes <span class="sc">%&gt;%</span></span>
<span id="cb164-2"><a href="modeling-complex-entities.html#cb164-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">distancia =</span> <span class="fu">haversine</span>(lng, lat, lngR, latR)) <span class="sc">%&gt;%</span></span>
<span id="cb164-3"><a href="modeling-complex-entities.html#cb164-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(idLugar) <span class="sc">%&gt;%</span></span>
<span id="cb164-4"><a href="modeling-complex-entities.html#cb164-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="at">wt =</span> distancia)</span>
<span id="cb164-5"><a href="modeling-complex-entities.html#cb164-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-6"><a href="modeling-complex-entities.html#cb164-6" aria-hidden="true" tabindex="-1"></a>lugares_con_imanes_ultimas</span></code></pre></div>
<pre><code>## # A tibble: 397 × 10
## # Groups:   idLugar [397]
##    idLugar FLAG_alandalus nombre    nombre_castellano   lat    lng region   latR
##      &lt;dbl&gt;          &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;             &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;
##  1       4              1 قرطبة     Córdoba            37.9 -4.78  Córdoba  37.9
##  2       6              1 إلبيرة    Elvira             37.2 -3.71  Granada  37.2
##  3       7              1 قلعة يحصب Alcalá la Real     37.4 -3.95  Granada  37.2
##  4       8              1 شذونة     Sidonia            36.5 -5.93  Algeci…  36.1
##  5      10              1 سرقسطة    Zaragoza           41.6 -0.883 Zarago…  41.6
##  6      15              1 أشونة     Osuna              37.2 -5.10  Córdoba  37.9
##  7      17              1 جزيرة شقر Alcira             39.2 -0.435 Valenc…  39.5
##  8      18              1 مرسية     Murcia             38.0 -1.13  Murcia   38.0
##  9      19              1 شاطبة     Játiva             39.0 -0.519 Valenc…  39.5
## 10      20              1 إشبيلية   Sevilla            37.4 -5.98  Sevilla  37.4
## # ℹ 387 more rows
## # ℹ 2 more variables: lngR &lt;dbl&gt;, distancia &lt;dbl&gt;</code></pre>
<p>Keep in mind that this is not necessarily intended to be the final version. You can play around with this data and manually move some locations from one region to another; you can also include other “magnets” and re-classify all places.</p>
<p>Let’s now try to visualize these regions:</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="modeling-complex-entities.html#cb166-1" aria-hidden="true" tabindex="-1"></a>modeledAndalusianRegions <span class="ot">&lt;-</span> base_plot_andalus_themed <span class="sc">+</span> </span>
<span id="cb166-2"><a href="modeling-complex-entities.html#cb166-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> lugares_con_imanes_ultimas,</span>
<span id="cb166-3"><a href="modeling-complex-entities.html#cb166-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> lng, <span class="at">y =</span> lat, <span class="at">col =</span> region),</span>
<span id="cb166-4"><a href="modeling-complex-entities.html#cb166-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.85</span>)</span>
<span id="cb166-5"><a href="modeling-complex-entities.html#cb166-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-6"><a href="modeling-complex-entities.html#cb166-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;PUAR_Cl10_Map01.png&quot;</span>, <span class="at">plot =</span> modeledAndalusianRegions,</span>
<span id="cb166-7"><a href="modeling-complex-entities.html#cb166-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">200</span>, <span class="at">height =</span> <span class="dv">150</span>, <span class="at">units =</span> <span class="st">&quot;mm&quot;</span>, <span class="at">dpi =</span> <span class="st">&quot;retina&quot;</span>)</span>
<span id="cb166-8"><a href="modeling-complex-entities.html#cb166-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-9"><a href="modeling-complex-entities.html#cb166-9" aria-hidden="true" tabindex="-1"></a>modeledAndalusianRegions</span></code></pre></div>
<p><img src="handbook_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>Now, we can use <code>lugares_con_imanes_ultimas</code> instead of <code>PUA$lugar</code> to group multiple locations into our modeled regions.</p>
<p>By the way, we can save this data back into our <code>PUA</code> data and reuse it later. But let’s keep the original file intact, just in case.</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="modeling-complex-entities.html#cb167-1" aria-hidden="true" tabindex="-1"></a>PUA<span class="sc">$</span>lugares_con_imanes <span class="ot">&lt;-</span> lugares_con_imanes_ultimas</span>
<span id="cb167-2"><a href="modeling-complex-entities.html#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(PUA, <span class="st">&quot;./data/PUA_processed/PUA_allDataTables_asList_UPDATED.rds&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="modeling-periods" class="section level2 hasAnchor" number="12.2">
<h2><span class="header-section-number">12.2</span> Modeling Periods<a href="modeling-complex-entities.html#modeling-periods" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Another important task that we may want to consider is modifying our data in such a way that individuals would be included not only into a specific decade when they died, but rather into all the decades when they lived. Here we have a bit of a problem. For some individuals we have both birth and death dates, so there we can easily get their life spans. What do we do with others for whom we know only death dates?</p>
<p>There is a variety of ways we can go about this issue. For the sake of simplicity, we can extrapolate birth dates using the average life span of people in our data. This may be a little too simplistic, but this should suffice for now.</p>
<blockquote>
<p>Alternatively, we can assign randomized life spans recreating the distribution of ages that we have in the data. We can apply more complex extrapolations by calculating average life spans for different periods and applying those life spans to individuals from relevant periods. We may also try to cluster individuals by their mutual similarities and extrapolate life span data within each cluster. And so on…</p>
</blockquote>
<p>Back to a simpler solution. It should suffice, since we are rounding up dates to decades anyway.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="modeling-complex-entities.html#cb168-1" aria-hidden="true" tabindex="-1"></a>ages <span class="ot">&lt;-</span> PUA<span class="sc">$</span>personaje <span class="sc">%&gt;%</span></span>
<span id="cb168-2"><a href="modeling-complex-entities.html#cb168-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(edad <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb168-3"><a href="modeling-complex-entities.html#cb168-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(edad)) <span class="sc">%&gt;%</span></span>
<span id="cb168-4"><a href="modeling-complex-entities.html#cb168-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(edad)</span>
<span id="cb168-5"><a href="modeling-complex-entities.html#cb168-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-6"><a href="modeling-complex-entities.html#cb168-6" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(ages<span class="sc">$</span>edad)</span></code></pre></div>
<pre><code>## [1] 1998</code></pre>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="modeling-complex-entities.html#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ages<span class="sc">$</span>edad)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    7.00   62.25   73.00   70.94   80.00  118.00</code></pre>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="modeling-complex-entities.html#cb172-1" aria-hidden="true" tabindex="-1"></a>PUA_personaje_fechas <span class="ot">&lt;-</span> PUA<span class="sc">$</span>personaje <span class="sc">%&gt;%</span></span>
<span id="cb172-2"><a href="modeling-complex-entities.html#cb172-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(idPersonaje, nacimiento, muerte, edad) <span class="sc">%&gt;%</span></span>
<span id="cb172-3"><a href="modeling-complex-entities.html#cb172-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(<span class="sc">~</span><span class="fu">replace</span>(., . <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>))</span>
<span id="cb172-4"><a href="modeling-complex-entities.html#cb172-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-5"><a href="modeling-complex-entities.html#cb172-5" aria-hidden="true" tabindex="-1"></a><span class="co"># potentially, we can try to add more dates from the table on offices (personaje_cargo), but</span></span>
<span id="cb172-6"><a href="modeling-complex-entities.html#cb172-6" aria-hidden="true" tabindex="-1"></a><span class="co"># for all those individuals with office dates we have at least death dates.</span></span>
<span id="cb172-7"><a href="modeling-complex-entities.html#cb172-7" aria-hidden="true" tabindex="-1"></a><span class="co"># So, this step does not really add anything. So, I comment out this step</span></span>
<span id="cb172-8"><a href="modeling-complex-entities.html#cb172-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-9"><a href="modeling-complex-entities.html#cb172-9" aria-hidden="true" tabindex="-1"></a><span class="co">#otras_fechas &lt;- PUA$personaje_cargo %&gt;%</span></span>
<span id="cb172-10"><a href="modeling-complex-entities.html#cb172-10" aria-hidden="true" tabindex="-1"></a><span class="co">#  filter(fechaCargo != 0) %&gt;%</span></span>
<span id="cb172-11"><a href="modeling-complex-entities.html#cb172-11" aria-hidden="true" tabindex="-1"></a><span class="co">#  select(idPersonaje, fechaCargo)</span></span>
<span id="cb172-12"><a href="modeling-complex-entities.html#cb172-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-13"><a href="modeling-complex-entities.html#cb172-13" aria-hidden="true" tabindex="-1"></a><span class="co">#PUAages &lt;- PUAages %&gt;%</span></span>
<span id="cb172-14"><a href="modeling-complex-entities.html#cb172-14" aria-hidden="true" tabindex="-1"></a><span class="co">#  left_join(otras_fechas)</span></span></code></pre></div>
<p>Now, we want to add some kind of value to age. Actually, we want to create a new column with <code>ifelse</code>:</p>
<ul>
<li>if we have age, we keep it;</li>
<li>else, we add some value;</li>
</ul>
<p>Now, the question is what value we should add? We mentioned average age, but that would be probably too easy and very clear how to do that. Let’s try something more interesting: we can randomly pull age values from our existing data and assign them to individuals who do not have age information. Doing this, we can reproduce the same distribution as we have in the original data.</p>
<p>This is how we can check if we got the distribution right. Essentially, we can visualize both vectors as histograms and check if their shapes are similar or not. If similar, we got the distribution right.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="modeling-complex-entities.html#cb173-1" aria-hidden="true" tabindex="-1"></a>missingAgesNumber <span class="ot">&lt;-</span> PUA_personaje_fechas <span class="sc">%&gt;%</span></span>
<span id="cb173-2"><a href="modeling-complex-entities.html#cb173-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(edad)) <span class="sc">%&gt;%</span></span>
<span id="cb173-3"><a href="modeling-complex-entities.html#cb173-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>() <span class="co"># 10815 missing ages</span></span>
<span id="cb173-4"><a href="modeling-complex-entities.html#cb173-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb173-5"><a href="modeling-complex-entities.html#cb173-5" aria-hidden="true" tabindex="-1"></a>agesExisting <span class="ot">&lt;-</span> ages<span class="sc">$</span>edad <span class="co"># 1998 available ages</span></span>
<span id="cb173-6"><a href="modeling-complex-entities.html#cb173-6" aria-hidden="true" tabindex="-1"></a>agesExtrapolated <span class="ot">&lt;-</span> <span class="fu">sample</span>(agesExisting, <span class="at">size =</span> missingAgesNumber, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb173-7"><a href="modeling-complex-entities.html#cb173-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-8"><a href="modeling-complex-entities.html#cb173-8" aria-hidden="true" tabindex="-1"></a><span class="co"># now, we visualize two AGE vectors as histograms. Their shapes must be very similar:</span></span>
<span id="cb173-9"><a href="modeling-complex-entities.html#cb173-9" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb173-10"><a href="modeling-complex-entities.html#cb173-10" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(agesExisting)</span>
<span id="cb173-11"><a href="modeling-complex-entities.html#cb173-11" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(agesExtrapolated)</span></code></pre></div>
<p><img src="handbook_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="modeling-complex-entities.html#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code></pre></div>
<p>We can also run <code>summary()</code> on both vectors. As you can see, our extrapolated vector is just a teeny-tiny bit different.</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="modeling-complex-entities.html#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(agesExisting)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    7.00   62.25   73.00   70.94   80.00  118.00</code></pre>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="modeling-complex-entities.html#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(agesExtrapolated)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    7.00   63.00   73.00   71.05   81.00  118.00</code></pre>
<p>A better way may be to apply this period by period, for example going by 100-year time spans. This way we can also get the chronological distribution more correctly.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="modeling-complex-entities.html#cb179-1" aria-hidden="true" tabindex="-1"></a>agesByAges <span class="ot">&lt;-</span> PUA_personaje_fechas <span class="sc">%&gt;%</span></span>
<span id="cb179-2"><a href="modeling-complex-entities.html#cb179-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(edad)) <span class="sc">%&gt;%</span></span>
<span id="cb179-3"><a href="modeling-complex-entities.html#cb179-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">century =</span> <span class="fu">ceiling</span>(<span class="fu">as.numeric</span>(muerte <span class="sc">/</span> <span class="dv">100</span>)) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb179-4"><a href="modeling-complex-entities.html#cb179-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-5"><a href="modeling-complex-entities.html#cb179-5" aria-hidden="true" tabindex="-1"></a>valuesPerCentury <span class="ot">&lt;-</span> agesByAges <span class="sc">%&gt;%</span></span>
<span id="cb179-6"><a href="modeling-complex-entities.html#cb179-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(century) <span class="sc">%&gt;%</span></span>
<span id="cb179-7"><a href="modeling-complex-entities.html#cb179-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb179-8"><a href="modeling-complex-entities.html#cb179-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-9"><a href="modeling-complex-entities.html#cb179-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(agesByAges, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(century), <span class="at">y =</span> edad)) <span class="sc">+</span></span>
<span id="cb179-10"><a href="modeling-complex-entities.html#cb179-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb179-11"><a href="modeling-complex-entities.html#cb179-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Century&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Age at Death&quot;</span>) <span class="sc">+</span></span>
<span id="cb179-12"><a href="modeling-complex-entities.html#cb179-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()  <span class="co"># Optional: Apply a minimal theme</span></span></code></pre></div>
<p><img src="handbook_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>So, let’s try to implement both. For some centuries we do not have many values (see below).</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="modeling-complex-entities.html#cb180-1" aria-hidden="true" tabindex="-1"></a>valuesPerCentury <span class="ot">&lt;-</span> agesByAges <span class="sc">%&gt;%</span></span>
<span id="cb180-2"><a href="modeling-complex-entities.html#cb180-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(century) <span class="sc">%&gt;%</span></span>
<span id="cb180-3"><a href="modeling-complex-entities.html#cb180-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb180-4"><a href="modeling-complex-entities.html#cb180-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-5"><a href="modeling-complex-entities.html#cb180-5" aria-hidden="true" tabindex="-1"></a>valuesPerCentury</span></code></pre></div>
<pre><code>## # A tibble: 9 × 2
##   century count
##     &lt;dbl&gt; &lt;int&gt;
## 1     200     4
## 2     300    36
## 3     400   295
## 4     500   439
## 5     600   555
## 6     700   470
## 7     800   179
## 8     900     8
## 9      NA    12</code></pre>
<p>Let’s extrapolate ages:</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="modeling-complex-entities.html#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">786</span>)</span>
<span id="cb182-2"><a href="modeling-complex-entities.html#cb182-2" aria-hidden="true" tabindex="-1"></a>agesExtrapolated <span class="ot">&lt;-</span> <span class="fu">sample</span>(agesExisting, <span class="at">size =</span> missingAgesNumber, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb182-3"><a href="modeling-complex-entities.html#cb182-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-4"><a href="modeling-complex-entities.html#cb182-4" aria-hidden="true" tabindex="-1"></a>PUA_personaje_fechas_modelled <span class="ot">&lt;-</span> PUA_personaje_fechas <span class="sc">%&gt;%</span></span>
<span id="cb182-5"><a href="modeling-complex-entities.html#cb182-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(edad)) <span class="sc">%&gt;%</span></span>
<span id="cb182-6"><a href="modeling-complex-entities.html#cb182-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">edad_extrapolated =</span> agesExtrapolated)</span>
<span id="cb182-7"><a href="modeling-complex-entities.html#cb182-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-8"><a href="modeling-complex-entities.html#cb182-8" aria-hidden="true" tabindex="-1"></a>PUA_personaje_fechas_existing <span class="ot">&lt;-</span> PUA_personaje_fechas <span class="sc">%&gt;%</span></span>
<span id="cb182-9"><a href="modeling-complex-entities.html#cb182-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(edad)) <span class="sc">%&gt;%</span></span>
<span id="cb182-10"><a href="modeling-complex-entities.html#cb182-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">edad_extrapolated =</span> edad)</span>
<span id="cb182-11"><a href="modeling-complex-entities.html#cb182-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-12"><a href="modeling-complex-entities.html#cb182-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-13"><a href="modeling-complex-entities.html#cb182-13" aria-hidden="true" tabindex="-1"></a>PUA_personaje_decadas <span class="ot">&lt;-</span> PUA_personaje_fechas_modelled <span class="sc">%&gt;%</span></span>
<span id="cb182-14"><a href="modeling-complex-entities.html#cb182-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_row</span>(PUA_personaje_fechas_existing) <span class="sc">%&gt;%</span></span>
<span id="cb182-15"><a href="modeling-complex-entities.html#cb182-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(idPersonaje) <span class="sc">%&gt;%</span></span>
<span id="cb182-16"><a href="modeling-complex-entities.html#cb182-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(muerte)) <span class="sc">%&gt;%</span></span>
<span id="cb182-17"><a href="modeling-complex-entities.html#cb182-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nacimiento1 =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(nacimiento), nacimiento, muerte <span class="sc">-</span> edad_extrapolated)) <span class="sc">%&gt;%</span></span>
<span id="cb182-18"><a href="modeling-complex-entities.html#cb182-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">decada_n =</span> <span class="fu">ceiling</span>(<span class="fu">as.numeric</span>(nacimiento1 <span class="sc">/</span> <span class="dv">10</span>)) <span class="sc">*</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb182-19"><a href="modeling-complex-entities.html#cb182-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">decada_m =</span> <span class="fu">ceiling</span>(<span class="fu">as.numeric</span>(muerte <span class="sc">/</span> <span class="dv">10</span>)) <span class="sc">*</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb182-20"><a href="modeling-complex-entities.html#cb182-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(idPersonaje, decada_n, decada_m) <span class="sc">%&gt;%</span></span>
<span id="cb182-21"><a href="modeling-complex-entities.html#cb182-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(idPersonaje) <span class="sc">%&gt;%</span></span>
<span id="cb182-22"><a href="modeling-complex-entities.html#cb182-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">decadas =</span> <span class="fu">list</span>(<span class="fu">seq</span>(<span class="at">from =</span> decada_n, <span class="at">to =</span> decada_m, <span class="at">by =</span> <span class="dv">10</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb182-23"><a href="modeling-complex-entities.html#cb182-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(decadas)</span>
<span id="cb182-24"><a href="modeling-complex-entities.html#cb182-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-25"><a href="modeling-complex-entities.html#cb182-25" aria-hidden="true" tabindex="-1"></a>PUA_personaje_decadas</span></code></pre></div>
<pre><code>## # A tibble: 56,166 × 2
##    idPersonaje decadas
##          &lt;dbl&gt;   &lt;dbl&gt;
##  1           1     120
##  2           1     130
##  3           1     140
##  4           1     150
##  5           1     160
##  6           1     170
##  7           1     180
##  8           7     350
##  9           7     360
## 10           7     370
## # ℹ 56,156 more rows</code></pre>
<p>Now, let’s compare two graphs: the graph of people when we do it only by their death dates, and another — where we consider people who is alive in those decades:</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="modeling-complex-entities.html#cb184-1" aria-hidden="true" tabindex="-1"></a>muerte_decadas <span class="ot">&lt;-</span> PUA_personaje_fechas <span class="sc">%&gt;%</span></span>
<span id="cb184-2"><a href="modeling-complex-entities.html#cb184-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(muerte)) <span class="sc">%&gt;%</span></span>
<span id="cb184-3"><a href="modeling-complex-entities.html#cb184-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">decadas =</span> <span class="fu">ceiling</span>(<span class="fu">as.numeric</span>(muerte <span class="sc">/</span> <span class="dv">10</span>)) <span class="sc">*</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb184-4"><a href="modeling-complex-entities.html#cb184-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(decadas) <span class="sc">%&gt;%</span></span>
<span id="cb184-5"><a href="modeling-complex-entities.html#cb184-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb184-6"><a href="modeling-complex-entities.html#cb184-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-7"><a href="modeling-complex-entities.html#cb184-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb184-8"><a href="modeling-complex-entities.html#cb184-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> muerte_decadas, <span class="fu">aes</span>(<span class="at">x =</span> decadas, <span class="at">y =</span> count), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb184-9"><a href="modeling-complex-entities.html#cb184-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">950</span>)) <span class="sc">+</span></span>
<span id="cb184-10"><a href="modeling-complex-entities.html#cb184-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="handbook_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="modeling-complex-entities.html#cb185-1" aria-hidden="true" tabindex="-1"></a>vida_decadas <span class="ot">&lt;-</span> PUA_personaje_decadas <span class="sc">%&gt;%</span></span>
<span id="cb185-2"><a href="modeling-complex-entities.html#cb185-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(decadas) <span class="sc">%&gt;%</span></span>
<span id="cb185-3"><a href="modeling-complex-entities.html#cb185-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb185-4"><a href="modeling-complex-entities.html#cb185-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-5"><a href="modeling-complex-entities.html#cb185-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb185-6"><a href="modeling-complex-entities.html#cb185-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> vida_decadas, <span class="fu">aes</span>(<span class="at">x =</span> decadas, <span class="at">y =</span> count), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb185-7"><a href="modeling-complex-entities.html#cb185-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">950</span>)) <span class="sc">+</span></span>
<span id="cb185-8"><a href="modeling-complex-entities.html#cb185-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="handbook_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<div id="a-1000-and-1-tries" class="section level3 hasAnchor" number="12.2.1">
<h3><span class="header-section-number">12.2.1</span> A 1000 And 1 Tries<a href="modeling-complex-entities.html#a-1000-and-1-tries" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As you can see, with extrapolated ages we have much more data and the graph is much smoother. There is a bit of a problem in our data, however. Since there is quite a lot of generated data, this curve is just one of the possible states. A possible solution to this can be a creation of, say, 1,000 of such distributions and finding some average between them. For this, we essentially will need to loop all the previous steps.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="modeling-complex-entities.html#cb186-1" aria-hidden="true" tabindex="-1"></a>vida_decadas_modelled <span class="ot">&lt;-</span> vida_decadas <span class="sc">%&gt;%</span></span>
<span id="cb186-2"><a href="modeling-complex-entities.html#cb186-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">version =</span> <span class="dv">0</span>, <span class="at">.before =</span> decadas)</span>
<span id="cb186-3"><a href="modeling-complex-entities.html#cb186-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-4"><a href="modeling-complex-entities.html#cb186-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">1000</span>, <span class="dv">1</span>)){</span>
<span id="cb186-5"><a href="modeling-complex-entities.html#cb186-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># here we do not use set.seed !</span></span>
<span id="cb186-6"><a href="modeling-complex-entities.html#cb186-6" aria-hidden="true" tabindex="-1"></a>  agesExtrapolated <span class="ot">&lt;-</span> <span class="fu">sample</span>(agesExisting, <span class="at">size =</span> missingAgesNumber, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb186-7"><a href="modeling-complex-entities.html#cb186-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-8"><a href="modeling-complex-entities.html#cb186-8" aria-hidden="true" tabindex="-1"></a>  PUA_personaje_fechas_modelled <span class="ot">&lt;-</span> PUA_personaje_fechas <span class="sc">%&gt;%</span></span>
<span id="cb186-9"><a href="modeling-complex-entities.html#cb186-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">is.na</span>(edad)) <span class="sc">%&gt;%</span></span>
<span id="cb186-10"><a href="modeling-complex-entities.html#cb186-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_column</span>(<span class="at">edad_extrapolated =</span> agesExtrapolated)</span>
<span id="cb186-11"><a href="modeling-complex-entities.html#cb186-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-12"><a href="modeling-complex-entities.html#cb186-12" aria-hidden="true" tabindex="-1"></a>  PUA_personaje_fechas_existing <span class="ot">&lt;-</span> PUA_personaje_fechas <span class="sc">%&gt;%</span></span>
<span id="cb186-13"><a href="modeling-complex-entities.html#cb186-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(edad)) <span class="sc">%&gt;%</span></span>
<span id="cb186-14"><a href="modeling-complex-entities.html#cb186-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">edad_extrapolated =</span> edad)</span>
<span id="cb186-15"><a href="modeling-complex-entities.html#cb186-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-16"><a href="modeling-complex-entities.html#cb186-16" aria-hidden="true" tabindex="-1"></a>  PUA_personaje_decadas <span class="ot">&lt;-</span> PUA_personaje_fechas_modelled <span class="sc">%&gt;%</span></span>
<span id="cb186-17"><a href="modeling-complex-entities.html#cb186-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_row</span>(PUA_personaje_fechas_existing) <span class="sc">%&gt;%</span></span>
<span id="cb186-18"><a href="modeling-complex-entities.html#cb186-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(idPersonaje) <span class="sc">%&gt;%</span></span>
<span id="cb186-19"><a href="modeling-complex-entities.html#cb186-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(muerte)) <span class="sc">%&gt;%</span></span>
<span id="cb186-20"><a href="modeling-complex-entities.html#cb186-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">nacimiento1 =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(nacimiento), nacimiento, muerte <span class="sc">-</span> edad_extrapolated)) <span class="sc">%&gt;%</span></span>
<span id="cb186-21"><a href="modeling-complex-entities.html#cb186-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">decada_n =</span> <span class="fu">ceiling</span>(<span class="fu">as.numeric</span>(nacimiento1 <span class="sc">/</span> <span class="dv">10</span>)) <span class="sc">*</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb186-22"><a href="modeling-complex-entities.html#cb186-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">decada_m =</span> <span class="fu">ceiling</span>(<span class="fu">as.numeric</span>(muerte <span class="sc">/</span> <span class="dv">10</span>)) <span class="sc">*</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb186-23"><a href="modeling-complex-entities.html#cb186-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(idPersonaje, decada_n, decada_m) <span class="sc">%&gt;%</span></span>
<span id="cb186-24"><a href="modeling-complex-entities.html#cb186-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(idPersonaje) <span class="sc">%&gt;%</span></span>
<span id="cb186-25"><a href="modeling-complex-entities.html#cb186-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">decadas =</span> <span class="fu">list</span>(<span class="fu">seq</span>(<span class="at">from =</span> decada_n, <span class="at">to =</span> decada_m, <span class="at">by =</span> <span class="dv">10</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb186-26"><a href="modeling-complex-entities.html#cb186-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest</span>(decadas)</span>
<span id="cb186-27"><a href="modeling-complex-entities.html#cb186-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-28"><a href="modeling-complex-entities.html#cb186-28" aria-hidden="true" tabindex="-1"></a>  vida_decadas_temp <span class="ot">&lt;-</span> PUA_personaje_decadas <span class="sc">%&gt;%</span></span>
<span id="cb186-29"><a href="modeling-complex-entities.html#cb186-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(decadas) <span class="sc">%&gt;%</span></span>
<span id="cb186-30"><a href="modeling-complex-entities.html#cb186-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb186-31"><a href="modeling-complex-entities.html#cb186-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">version =</span> i, <span class="at">.before =</span> decadas)</span>
<span id="cb186-32"><a href="modeling-complex-entities.html#cb186-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-33"><a href="modeling-complex-entities.html#cb186-33" aria-hidden="true" tabindex="-1"></a>  vida_decadas_modelled <span class="ot">&lt;-</span> vida_decadas_modelled <span class="sc">%&gt;%</span></span>
<span id="cb186-34"><a href="modeling-complex-entities.html#cb186-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_row</span>(vida_decadas_temp)</span>
<span id="cb186-35"><a href="modeling-complex-entities.html#cb186-35" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now, let’s graph is and see how 1,000 iterations would be different from a single iteration. Thus, on the graph below we have two lines: 1) a light blue line of varying width, which represents the results of 1,000 iterations; and 2) a black line that represents a single variation.</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="modeling-complex-entities.html#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(vida_decadas_modelled) <span class="sc">+</span></span>
<span id="cb187-2"><a href="modeling-complex-entities.html#cb187-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> vida_decadas_modelled,</span>
<span id="cb187-3"><a href="modeling-complex-entities.html#cb187-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> decadas, <span class="at">y =</span> count,</span>
<span id="cb187-4"><a href="modeling-complex-entities.html#cb187-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> <span class="fu">as.factor</span>(version)),</span>
<span id="cb187-5"><a href="modeling-complex-entities.html#cb187-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb187-6"><a href="modeling-complex-entities.html#cb187-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">col =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb187-7"><a href="modeling-complex-entities.html#cb187-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> vida_decadas, <span class="fu">aes</span>(<span class="at">x =</span> decadas, <span class="at">y =</span> count), <span class="at">linewidth =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb187-8"><a href="modeling-complex-entities.html#cb187-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">950</span>)) <span class="sc">+</span></span>
<span id="cb187-9"><a href="modeling-complex-entities.html#cb187-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb187-10"><a href="modeling-complex-entities.html#cb187-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) </span></code></pre></div>
<p><img src="handbook_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<p>For the most part, the black line seems to be within the range of the blue lines, suggesting that the single extrapolation is not an extreme outlier. There are more robust techniques that can be used to improve this distribution, but for our purposes here we may consider a single extrapolation more or less acceptable. The most important value of this extrapolation is that now for each date we have an estimate of individuals who are alive at that moment in time.</p>
<p>[<strong>#TODO</strong>: these techniques should be discussed, explained and demonstrated.]</p>
<!--

**NOTE:** a more complex “age assignment” can be done based on sampling ages of different groups, like Cordobans would have one distribution, while jurists may have a different one; a person who is both a Cordoban and a jurist should have their probable age pulled from both samples, perhaps multiple times; then a single age should be pulled randomly from such pools of ages created for each individual. 

-->
<!--

IMPROVEMENTS:

1. Blue Lines: Each blue line represents a possible extrapolation of ages for the 10,000 individuals. Since there are multiple blue lines, we can understand that there are numerous potential age distributions for these individuals based on the knowledge from the 2,000 with known ages.

2. Black Line: This is a single extrapolation, essentially one possible age distribution for the 10,000 individuals.

Given this understanding, you want to determine if a single extrapolation (the black line) is representative enough or if it falls within the general range of the 10,000 extrapolations (the blue lines).

Here are some suggestions and observations:

1. Visual Inspection:

- For the most part, the black line seems to be within the range of the blue lines, suggesting that the single extrapolation is not an extreme outlier. However, there are periods (like the middle of the x-axis) where the black line falls outside the densest region of the blue lines, indicating potential divergence.

2. Statistical Analysis:

- To quantitatively determine the "acceptability" of the black line, you might consider calculating summary statistics (mean, median, standard deviation, etc.) for each period across the 10,000 blue lines. This will provide a range (confidence interval) for each period. You can then check if the black line's value for each period falls within this range.
If you find that the black line frequently falls outside these ranges, it might suggest that a single extrapolation might not be representative.

3. Smoothing:

- Consider applying a smoothing function (like a moving average) to the lines to better visualize trends and reduce noise. This can help in more easily identifying periods where the single extrapolation diverges from the majority.

4. Shading:

- Using shading (or a ribbon) to indicate the range between, for example, the 5th and 95th percentiles of the blue lines can visually show where most of the extrapolations lie. This can provide a clear visual cue to assess if the black line is within this range.

5. Sampling More:

- If computational resources allow, consider performing more than one single extrapolation (perhaps 100 or 1,000) and see how often they fall within the general range of the 10,000 extrapolations. This can give you a better idea of the variability of single extrapolations.

6. Domain Knowledge:

- Consult with experts in the domain or field to understand if there are specific periods or reasons why the extrapolation might diverge. Sometimes, there might be historical or contextual reasons for such deviations.
In conclusion, while visual inspection can provide some insights, combining it with quantitative analyses will give you a more comprehensive understanding of the acceptability of the single extrapolation.

-->

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="geographical-maps-cartograms.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="class-12.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "github"]
},
"fontsettings": {
"theme": "white",
"family": "serif",
"size": 2
},
"edit": {
"link": "https://github.com/eis1600/hdis-audition-statements/edit/main/110-Class11.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/eis1600/hdis-audition-statements/blob/main/110-Class11.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"info": true
});
});
</script>

</body>

</html>
